!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).CG={})}(this,function(e){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function t(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function h(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n,i;t=r,i=o[n=e],n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=r(n);return a(this,i?(e=r(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var f=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,n),this.callback=e,this.options=t,this._playing=!1,this._step=-1}return s(n,[{key:"_setTimeout",value:function(){var e=this.options.frameDuration;this._requestId=e?window.setTimeout(this._anim.bind(this),e):window.requestAnimationFrame(this._anim.bind(this))}},{key:"_clearTimeout",value:function(){this.options.frameDuration?window.clearTimeout(this._requestId):window.cancelAnimationFrame(this._requestId)}},{key:"_anim",value:function(){var e=this.options,t=e.frameCount,n=e.recycle;if(t&&this._step>=t-1?this._step=0:this._step+=1,this.callback(this._step),!1===n&&t&&this._step===t-1)return this._playing=!1,void(this._step=-1);this._playing&&this._setTimeout()}},{key:"start",value:function(){this._playing||(this._setTimeout(),this._playing=!0)}},{key:"stop",value:function(){this._clearTimeout(),this._playing=!1,this._step=-1}},{key:"pause",value:function(){this._playing&&(this._clearTimeout(),this._playing=!1)}},{key:"reset",value:function(){this._clearTimeout(),this._playing=!1,this._step=-1,this.callback(this._step)}},{key:"setStep",value:function(e){var t=this.options.frameCount,n=Number.parseInt(e,10);!this._playing&&t&&-1<n&&n<t&&(this._step=n,this.callback(this._step))}},{key:"next",value:function(){var e=this.options.frameCount;this._playing||(e&&this._step>=e-1?this._step=0:this._step+=1,this.callback(this._step))}},{key:"prev",value:function(){var e=this.options.frameCount;this._playing||(this._step<=0?this._step=e?e-1:0:--this._step,this.callback(this._step))}}]),n}(),g=3,v="#ca562c",d=2,y="#3969AC",x={width:2,strokeColor:"#008080",fillColor:"#b4c8a8"},w=1e-10;function m(e,t){return e.equal(t)?0:e.x<t.x||e.x===t.x&&e.y<t.y?-1:1}function b(e,t){return e.equal(t)?0:e.y<t.y||e.y===t.y&&e.x<t.x?-1:1}function E(e,t,n){return e.x*t.y-e.y*t.x+t.x*n.y-t.y*n.x+n.x*e.y-n.y*e.x}function C(e,t,n){return Math.abs(E(e,t,n))<w}function _(e,t,n){return 0<E(e,t,n)}function T(e,t,n){return 0<=E(e,t,n)}function P(e,t,n){return E(e,t,n)<0}function I(e,t,n){var i=E(e,t,n);if(0<i)return!0;if(i<0)return!1;if(e.distanceTo(t)<e.distanceTo(n))return!0;if(e.distanceTo(t)>e.distanceTo(n))return!1;throw new Error("toLeft: Input same point")}function V(e,t,n){return 0===E(e,t,n)&&(e.x!==t.x?e.x<=n.x&&n.x<=t.x||t.x<=n.x&&n.x<=e.x:e.y<=n.y&&n.y<=t.y||t.y<=n.y&&n.y<=e.y)}function O(e,t,n,i){return!(e.equal(n)||e.equal(i)||t.equal(n)||t.equal(i))&&(_(e,t,n)!==_(e,t,i)&&_(n,i,e)!==_(n,i,t))}function A(e,t,n){for(var i=e.length,r=0;r<i-1;r++)if(O(e[r],e[r+1],t,n))return!1;return!(!e[i-1].equal(e[0])&&O(e[i-1],e[0],t,n))}function S(e,t,n,i){return T(t,n,e)?_(t,i,e)&&_(i,t,n):!(T(t,i,n)&&T(i,t,e))}function F(e){for(var t=0,n=1;n<e.length;n++)(e[n].y<e[t].y||e[n].y===e[t].y&&e[n].x<e[t])&&(t=n);return t}function M(e){var t=e.slice(),n=F(t),i=t[n];return t.splice(n,1),t.sort(function(e,t){return E(i,t,e)}),t.unshift(i),t}var N=Object.freeze({__proto__:null,PRECISION:w,pointComparator:m,pointComparatorY:b,area2:E,areaSign:function(e,t,n){var i=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y);return i<-.5?-1:.5<i?1:0},collinear:C,left:_,leftOn:T,right:P,toLeft:I,between:V,inTriangle:function(e,t,n,i){var r=I(t,n,i);return I(e,t,i)===r&&r===I(n,e,i)},intersectProp:O,diagonalie:A,inCone:S,LTL:F,leftSort:M,inCircumcircle:function(e,t,n,i){var r=Math.pow(i.x,2)+Math.pow(i.y,2),o=Math.pow(e.x,2)+Math.pow(e.y,2)-r,a=Math.pow(t.x,2)+Math.pow(t.y,2)-r,s=Math.pow(n.x,2)+Math.pow(n.y,2)-r;return 0<(e.x-i.x)*(t.y-i.y)*s+(t.x-i.x)*(n.y-i.y)*o+(n.x-i.x)*(e.y-i.y)*a-(e.x-i.x)*(n.y-i.y)*a-(t.x-i.x)*(e.y-i.y)*s-(n.x-i.x)*(t.y-i.y)*o},volumeSign:function(e,t,n,i){var r=e.x-i.x,o=e.y-i.y,a=e.z-i.z,s=t.x-i.x,h=t.y-i.y,u=t.z-i.z,c=n.x-i.x,l=n.y-i.y,f=n.z-i.z,g=r*(h*f-u*l)-o*(s*f-u*c)+a*(s*l-h*c);return g<-.5?-1:.5<g?1:0}}),R=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;o(this,i),this.x=e,this.y=t,this.z=n}return s(i,[{key:"distanceTo",value:function(e){if(!(e instanceof i))throw new TypeError("parameter is not Point");return Math.sqrt(Math.pow(Math.abs(this.x-e.x),2)+Math.pow(Math.abs(this.y-e.y),2)+Math.pow(Math.abs(this.z-e.z),2))}},{key:"equal",value:function(e){if(!(e instanceof i))throw new TypeError("parameter is not Point");return Math.abs(this.x-e.x)<w&&Math.abs(this.y-e.y)<w&&Math.abs(this.z-e.z)<w}}]),i}(),L=function(){function a(e,t){if(o(this,a),e instanceof R&&t instanceof R)return this.begin=e,void(this.end=t);try{this.begin=new R(e.x,e.y),this.end=new R(t.x,t.y)}catch(e){throw new TypeError("Segment needs begin & end point")}}return s(a,[{key:"parallelInt",value:function(e){return 0!==E(this.begin,this.end,e.begin)?null:V(this.begin,this.end,e.begin)?e.begin:V(this.begin,this.end,e.end)?e.end:V(e.begin,e.end,this.begin)?this.begin:V(e.begin,e.end,this.end)?this.end:null}},{key:"intersect",value:function(e){if(!(e instanceof a))throw new TypeError("Not Segment");var t=this.begin.x*(e.end.y-e.begin.y)+this.end.x*(e.begin.y-e.end.y)+e.end.x*(this.end.y-this.begin.y)+e.begin.x*(this.begin.y-this.end.y);if(0==t)return this.parallelInt(e);var n=(this.begin.x*(e.end.y-e.begin.y)+e.begin.x*(this.begin.y-e.end.y)+e.end.x*(e.begin.y-this.begin.y))/t,i=-(this.begin.x*(e.begin.y-this.end.y)+this.end.x*(this.begin.y-e.begin.y)+e.begin.x*(this.end.y-this.begin.y))/t;if(n<-w||1+w<n||i<-w||1+w<i)return null;var r=this.begin.x+n*(this.end.x-this.begin.x),o=this.begin.y+n*(this.end.y-this.begin.y);return new R(r,o)}},{key:"intersectProp",value:function(e){if(!(e instanceof a))throw new TypeError("Not Segment");return I(this.begin,this.end,e.begin)!==I(this.begin,this.end,e.end)&&I(e.begin,e.end,this.begin)!==I(e.begin,e.end,this.end)}}]),a}(),H=function(){function t(e){o(this,t),this.vertices=e.slice(),e[0]&&!e[0].equal(e[e.length-1])&&this.vertices.push(e[0])}return s(t,[{key:"area",value:function(){for(var e=this.vertices.length,t=0,n=0;n<e-1;n++)t+=(this.vertices[n].x+this.vertices[n+1].x)*(this.vertices[n+1].y-this.vertices[n].y);return t/2}}]),t}(),q=function(){function r(e,t,n,i){o(this,r),this.leftBottom=new R(e,t),this.rightTop=new R(n,i)}return s(r,[{key:"Intersect",value:function(e){return!(this.leftBottom.x>e.rightTop.x||this.rightTop.x<e.leftBottom.x)&&!(this.leftBottom.y>e.rightTop.y||this.rightTop.y<e.leftBottom.y)}}]),r}(),z=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;o(this,i),this.x=e,this.y=t,this.z=n}return s(i,[{key:"normalize",value:function(){var e=this.length;return new i(this.x/e,this.y/e,this.z/e)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"rotateZ",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.x,r=this.y;return this.x=i*t-r*n,this.y=i*n+r*t,this}},{key:"copy",value:function(){return new i(this.x,this.y,this.z)}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}],[{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}},{key:"cross",value:function(e,t){return new i(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}},{key:"cos",value:function(e,t){return this.dot(e.normalize(),t.normalize())}},{key:"projection",value:function(e,t){return e.copy().scale(t.length*this.cos(e,t))}}]),i}(),j=function(){function n(e,t){o(this,n);try{this.origin=new R(e.x,e.y),this.direction=new z(t.x,t.y)}catch(e){throw new TypeError("Line need origin and direction:",e)}}return s(n,[{key:"getPoint",value:function(e){return new R(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}},{key:"intersect",value:function(e){var t=this.getPoint(1),n=e.getPoint(1),i=this.origin.x*(n.y-e.origin.y)+t.x*(e.origin.y-n.y)+n.x*(t.y-this.origin.y)+e.origin.x*(this.origin.y-t.y);if(0==i)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var r=(this.origin.x*(n.y-e.origin.y)+e.origin.x*(this.origin.y-n.y)+n.x*(e.origin.y-this.origin.y))/i,o=this.origin.x+r*(t.x-this.origin.x),a=this.origin.y+r*(t.y-this.origin.y);return new R(o,a)}},{key:"intersectSegProp",value:function(e){return this.right(e.begin)!==this.right(e.end)}},{key:"intersectSegment",value:function(e){var t=this.getPoint(1),n=this.origin.x*(e.end.y-e.begin.y)+t.x*(e.begin.y-e.end.y)+e.end.x*(t.y-this.origin.y)+e.begin.x*(this.origin.y-t.y);if(0==n)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var i=-(this.origin.x*(e.begin.y-t.y)+t.x*(this.origin.y-e.begin.y)+e.begin.x*(t.y-this.origin.y))/n;if(i<-w||1+w<i)throw new Error("Line not intersect segment: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var r=e.begin.x+i*(e.end.x-e.begin.x),o=e.begin.y+i*(e.end.y-e.begin.y);return new R(r,o)}},{key:"intersectRay",value:function(e){var t=this.getPoint(1),n=e.getPoint(1),i=this.origin.x*(n.y-e.origin.y)+t.x*(e.origin.y-n.y)+n.x*(t.y-this.origin.y)+e.origin.x*(this.origin.y-t.y);if(0==i)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(seg)));var r=-(this.origin.x*(e.origin.y-t.y)+t.x*(this.origin.y-e.origin.y)+e.origin.x*(t.y-this.origin.y))/i;if(r<-w)return null;var o=e.origin.x+r*(n.x-e.origin.x),a=e.origin.y+r*(n.y-e.origin.y);return new R(o,a)}},{key:"rayIntersectSegment",value:function(e){var t=this.getPoint(1),n=this.origin.x*(e.end.y-e.begin.y)+t.x*(e.begin.y-e.end.y)+e.end.x*(t.y-this.origin.y)+e.begin.x*(this.origin.y-t.y);if(0==n)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var i=(this.origin.x*(e.end.y-e.begin.y)+e.begin.x*(this.origin.y-e.end.y)+e.end.x*(e.begin.y-this.origin.y))/n,r=-(this.origin.x*(e.begin.y-t.y)+t.x*(this.origin.y-e.begin.y)+e.begin.x*(t.y-this.origin.y))/n;if(i<-w||r<-w||1+w<r)return null;var o=e.begin.x+r*(e.end.x-e.begin.x),a=e.begin.y+r*(e.end.y-e.begin.y);return new R(o,a)}},{key:"right",value:function(e){return P(this.origin,this.getPoint(1),e)}},{key:"left",value:function(e){return _(this.origin,this.getPoint(1),e)}}],[{key:"bisect",value:function(e,t){if(e.equal(t))throw new Error("Input equal points");return new n(new R((e.x+t.x)/2,(e.y+t.y)/2),new z(t.x-e.x,t.y-e.y).normalize().rotateZ(-Math.PI/2))}}]),n}(),D=Object.freeze({__proto__:null,Util:N,Point:R,Segment:L,Polygon:H,Rectangle:q,Line:j,Vector:z}),J=function(){function i(e){o(this,i),this.canvas=e;var t=Math.max(window.devicePixelRatio||2,2),n=this.canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.canvas.width=n.width*t,this.canvas.height=n.height*t,this.ctx=e.getContext("2d"),this.ctx.scale(t,t),this.ctx.lineJoin="round"}return s(i,[{key:"clearCanvas",value:function(){var e=this.ctx.canvas,t=e.width,n=e.height;this.ctx.clearRect(0,0,t,n)}},{key:"drawPoint",value:function(e,t,n){var i,r=1<arguments.length&&void 0!==t?t:g,o=2<arguments.length&&void 0!==n?n:v;e&&e instanceof R&&(i=this.height,this.ctx.save(),this.ctx.lineWidth=r,this.ctx.strokeStyle=o,this.ctx.beginPath(),this.ctx.arc(e.x,i-e.y,r/2,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}},{key:"drawPoints",value:function(e,t,n){var i,r=this,o=1<arguments.length&&void 0!==t?t:g,a=2<arguments.length&&void 0!==n?n:v;Array.isArray(e)&&(i=this.height,this.ctx.save(),this.ctx.lineWidth=o,this.ctx.strokeStyle=a,this.ctx.beginPath(),e.forEach(function(e){r.ctx.moveTo(e.x,i-e.y),r.ctx.arc(e.x,i-e.y,o/2,0,2*Math.PI)}),this.ctx.stroke(),this.ctx.restore())}},{key:"drawSegment",value:function(e,t,n){var i=1<arguments.length&&void 0!==t?t:d,r=2<arguments.length&&void 0!==n?n:y,o=this.height;this.ctx.save(),void 0!==i&&(this.ctx.lineWidth=i),void 0!==r&&(this.ctx.strokeStyle=r),this.ctx.beginPath(),this.ctx.moveTo(e.begin.x,o-e.begin.y),this.ctx.lineTo(e.end.x,o-e.end.y),this.ctx.stroke(),this.ctx.restore()}},{key:"drawSegments",value:function(e,t,n){var i=this,r=1<arguments.length&&void 0!==t?t:d,o=2<arguments.length&&void 0!==n?n:y;this.ctx.save(),void 0!==r&&(this.ctx.lineWidth=r),void 0!==o&&(this.ctx.strokeStyle=o);var a=this.height;this.ctx.beginPath(),e.forEach(function(e){i.ctx.moveTo(e.begin.x,a-e.begin.y),i.ctx.lineTo(e.end.x,a-e.end.y)}),this.ctx.stroke(),this.ctx.restore()}},{key:"drawPolygon",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{style:{}},i=h({},x);Object.assign(i,n.style),this.ctx.save(),this.ctx.lineWidth=i.width,this.ctx.fillStyle=i.fillColor,this.ctx.strokeStyle=i.strokeColor;var r=e.vertices;if(r&&Array.isArray(r)&&!(r.length<1)){var o=this.height;this.ctx.beginPath(),this.ctx.moveTo(r[0].x,o-r[0].y);for(var a=1;a<r.length;a++)this.ctx.lineTo(r[a].x,o-r[a].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}}},{key:"drawPolygons",value:function(e,t){var n,i,r,o=this,a=1<arguments.length&&void 0!==t?t:{style:{}};e&&Array.isArray(e)&&(n=h({},x),Object.assign(n,a.style),this.ctx.save(),this.ctx.lineWidth=n.width,this.ctx.fillStyle=n.fillColor,this.ctx.strokeStyle=n.strokeColor,i=this.height,this.ctx.beginPath(),e.forEach(function(e){if(r=e.vertices?e.vertices:e,Array.isArray(r)&&1<r.length){o.ctx.moveTo(r[0].x,i-r[0].y);for(var t=1;t<r.length;t++)o.ctx.lineTo(r[t].x,i-r[t].y);o.ctx.closePath()}}),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore())}},{key:"drawText",value:function(e,t,n,i){var r=1<arguments.length&&void 0!==t?t:0,o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==i?i:{style:{},fill:!0},s=this.height;this.ctx.save(),a.textBaseline&&(this.ctx.textBaseline=a.textBaseline),this.ctx.font=a.font,a.fill?this.ctx.fillText(e,r,s-o):this.ctx.strokeText(e,r,s-o),this.ctx.restore()}}]),i}(),B=function(){function n(e,t){o(this,n),this._coord=e,this._incidentEdge=t}return s(n,[{key:"incidentEdge",set:function(e){this._incidentEdge=e},get:function(){return this._incidentEdge}},{key:"coord",set:function(e){this._coord=e},get:function(){return this._coord}},{key:"incidentFaces",get:function(){for(var e=this._incidentEdge,t=e.twin.next,n=[e.incidentFace];t!==e;)n.push(t.incidentFace),t=t.twin.next;return n.filter(function(e){return!!e})}}]),n}(),Z=function(){function t(e){if(o(this,t),!(e&&e instanceof B))throw new Error("Origin must is vertex");this._origin=e}return s(t,[{key:"origin",set:function(e){this._origin=e},get:function(){return this._origin}},{key:"end",get:function(){return this.twin.origin}},{key:"direction",set:function(e){this._direction=e},get:function(){return this._direction}},{key:"twin",set:function(e){if(!(e&&e instanceof t))throw new Error("Twin must be halfEdge");this._twin=e},get:function(){return this._twin}},{key:"incidentFace",set:function(e){this._incidentFace=e},get:function(){return this._incidentFace}},{key:"next",set:function(e){if(!(e&&e instanceof t))throw new Error("Next must be halfEdge");this._next=e},get:function(){return this._next}},{key:"prev",set:function(e){if(!(e&&e instanceof t))throw new Error("Prev must be halfEdge");this._prev=e},get:function(){return this._prev}}]),t}(),W=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(o(this,i),e){if(!(e instanceof Z))throw new Error("Face must has halfEdge outerComponent");e.incidentFace=this;for(var n=e.next;n&&n!==e;)n.incidentFace=this,n=n.next;this._outerComponent=e}if(!(t&&t instanceof Array))throw new Error("Face innnerComponents must is array");this._innerComponents=t}return s(i,[{key:"addInnerComponent",value:function(e){if(!(e&&e instanceof Z))throw new Error("InnerComponent is HalfEdge");this._innerComponents.push(e)}},{key:"getVertices",value:function(){for(var e=this._outerComponent.next,t=[this._outerComponent.origin.coord];e&&e!==this._outerComponent;)t.push(e.origin.coord),e=e.next;return t}},{key:"getEdges",value:function(){for(var e=[this._outerComponent],t=this._outerComponent.next;t&&t!==this._outerComponent;)e.push(t),t=t.next;return e}},{key:"getAdjacentFaces",value:function(){for(var e=this._outerComponent.next,t=this._outerComponent.twin.incidentFace,n=t?[t]:[];e&&e!==this._outerComponent;)(t=e.twin.incidentFace)&&n.push(t),e=e.next;return n}},{key:"outerComponent",get:function(){return this._outerComponent},set:function(e){this._outerComponent=e}},{key:"innerComponents",get:function(){return this._innerComponents}},{key:"site",set:function(e){this._site=e},get:function(){return this._site}}]),i}();var U=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,n),this.faces=[],this.halfEdges=[],this.vertices=[],t.needInit&&e&&Array.isArray(e)&&0<e.length&&function(e,t,n,i){for(var r,o,a,s,h,u=e.length,c=0;c<u;c++)i.push(new B(e[c]));for(c=0;c<u;c++)s=new Z(i[c]),i[c].incidentEdge=s,h=new Z(i[a=c===u-1?0:c+1]),(s.twin=h).twin=s,n.push(s,h);for(c=0;c<u;c++)o=0===c?2*(u-1):2*(c-1),n[r=2*c].prev=n[o],n[o].next=n[r],a=0===c?2*(u-1)+1:2*(c-1)+1,n[r=2*c+1].next=n[a],n[a].prev=n[r];var l=new W(n[0]);t.push(l)}(e,this.faces,this.halfEdges,this.vertices)}return s(n,[{key:"removeVertex",value:function(t){var e=this.vertices.findIndex(function(e){return e===t});return-1!==e&&this.vertices.splice(e,1)}},{key:"insertVertex",value:function(){var e;(e=this.vertices).push.apply(e,arguments)}},{key:"removeHalfEdge",value:function(t){var e=this.halfEdges.findIndex(function(e){return e===t});return-1!==e&&this.halfEdges.splice(e,1)}},{key:"insertHalfEdge",value:function(){var e;(e=this.halfEdges).push.apply(e,arguments)}},{key:"removeFace",value:function(t){var e=this.faces.findIndex(function(e){return e===t});return-1!==e&&this.faces.splice(e,1)}},{key:"insertFace",value:function(){var e;(e=this.faces).push.apply(e,arguments)}}]),n}();var Y=function(){function t(e){o(this,t),this.compare=e||t.defaultCompareFunction}return s(t,[{key:"equal",value:function(e,t){return 0===this.compare(e,t)}},{key:"lessThan",value:function(e,t){return this.compare(e,t)<0}},{key:"greaterThan",value:function(e,t){return 0<this.compare(e,t)}},{key:"lessThanOrEqual",value:function(e,t){return this.lessThan(e,t)||this.equal(e,t)}},{key:"greaterThanOrEqual",value:function(e,t){return this.greaterThan(e,t)||this.equal(e,t)}},{key:"reverse",value:function(){var n=this.compare;this.compare=function(e,t){return n(t,e)}}}],[{key:"defaultCompareFunction",value:function(e,t){return e===t?0:e<t?-1:1}}]),t}(),G=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length?arguments[2]:void 0;o(this,r),this.heapType=t,this.compareFunciont=n,this.nodeValueComparator=new Y(n),this.heapContainter=e.slice();for(var i=Math.floor(this.length/2);0<=i;i--)this.heapifyDown(i)}return s(r,[{key:"inHeap",value:function(e){return 0<=e&&e<this.length}},{key:"getLeftIndex",value:function(e){return 2*e+1}},{key:"getRightIndex",value:function(e){return 2*e+2}},{key:"getParentIndex",value:function(e){return Math.floor((e-1)/2)}},{key:"getLeft",value:function(e){return this.heapContainter[this.getLeftIndex(e)]}},{key:"getRight",value:function(e){return this.heapContainter[this.getRightIndex(e)]}},{key:"getParent",value:function(e){return this.heapContainter[this.getParentIndex(e)]}},{key:"insert",value:function(e){return this.heapContainter.push(e),this.heapifyUp(),this}},{key:"pop",value:function(){if(0===this.length)return null;if(1===this.length)return this.heapContainter.pop();var e=this.heapContainter[0];return this.heapContainter[0]=this.heapContainter.pop(),this.heapifyDown(),e}},{key:"heapifyUp",value:function(e){for(var t=e||this.heapContainter.length-1,n=this.getParentIndex(t);this.inHeap(n)&&!this.isCorrectOrder(this.heapContainter[n],this.heapContainter[t]);)this.swap(t,n),t=this.getParentIndex(t),n=this.getParentIndex(t)}},{key:"heapifyDown",value:function(e){for(var t=e||0,n=this.getLeftIndex(t);this.inHeap(n)&&(this.inHeap(n+1)&&this.isCorrectOrder(this.heapContainter[n+1],this.heapContainter[n])&&(n+=1),!this.isCorrectOrder(this.heapContainter[t],this.heapContainter[n]));)this.swap(t,n),t=n,n=this.getLeftIndex(t)}},{key:"isCorrectOrder",value:function(e,t){return this.heapType?this.nodeValueComparator.greaterThanOrEqual(e,t):this.nodeValueComparator.lessThanOrEqual(e,t)}},{key:"swap",value:function(e,t){var n=this.heapContainter[e];this.heapContainter[e]=this.heapContainter[t],this.heapContainter[t]=n}},{key:"toString",value:function(){return this.heapContainter.toString()}},{key:"length",get:function(){return this.heapContainter.length}}]),r}(),X=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;o(this,n),this.left=null,this.right=null,this.parent=null,this.value=e,this.compareFunction=t,this.nodeValueComparator=new Y(t)}return s(n,[{key:"setValue",value:function(e){return this.value=e,this}},{key:"setLeft",value:function(e){return this.left=e,this.left&&(this.left.parent=this),this}},{key:"setRight",value:function(e){return this.right=e,this.right&&(this.right.parent=this),this}},{key:"removeChild",value:function(e){return this.left&&this.nodeValueComparator.equal(this.left.value,e.value)?!(this.left=null):!(!this.right||!this.nodeValueComparator.equal(this.right.value,e.value))&&!(this.right=null)}},{key:"replaceChild",value:function(e,t){return!(!e||!t)&&(this.left&&this.nodeValueComparator.equal(this.left,e)?(this.left=t,!0):!(!this.right||!this.nodeValueComparator.equal(this.right,e))&&(this.right=t,!0))}},{key:"traverseInOrder",value:function(e){var t=0<arguments.length&&void 0!==e?e:[];return this.left&&this.left.traverseInOrder(t),null!==this.value&&t.push(this.value),this.right&&this.right.traverseInOrder(t),t}},{key:"traverseInOrderCallback",value:function(e){this.left&&this.left.traverseInOrderCallback(e),null!==this.value&&e(this),this.right&&this.right.traverseInOrderCallback(e)}},{key:"sibling",value:function(){return this.parent?this.parent.left===this?this.parent.right:this.parent.left:null}},{key:"isRight",value:function(){return!(!this.parent||this.parent.right!==this)}},{key:"isLeft",value:function(){return!(!this.parent||this.parent.left!==this)}},{key:"getLeafNodes",value:function(e){var t=0<arguments.length&&void 0!==e?e:[];return this.left&&this.left.getLeafNodes(t),this.right&&this.right.getLeafNodes(t),this.left||this.right||!this.value||t.push(this.value),t}},{key:"leftHight",get:function(){return this.left?this.left.height:0}},{key:"rightHight",get:function(){return this.right?this.right.height:0}},{key:"height",get:function(){return Math.max(this.leftHight,this.rightHight)+1}},{key:"balanceFactor",get:function(){return this.leftHight-this.rightHight}}],[{key:"copyNode",value:function(e,t){t.setValue(e.value),t.setLeft(e.left),t.setRight(e.right)}}]),n}(),Q=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(r,X);var i=u(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length?arguments[1]:void 0;return o(this,r),(e=i.call(this,t)).compareFunction=n,e.nodeValueComparator=new Y(n),e}return s(r,[{key:"insert",value:function(e){return null===this.value?(this.value=e,this):this.nodeValueComparator.lessThan(e,this.value)?this.left?this.left.insert(e):(t=new r(e,this.compareFunction),this.setLeft(t),t):this.nodeValueComparator.greaterThan(e,this.value)?this.right?this.right.insert(e):(t=new r(e,this.compareFunction),this.setRight(t),t):this;var t}},{key:"find",value:function(e){return this.nodeValueComparator.equal(e,this.value)?this:this.nodeValueComparator.lessThan(e,this.value)&&this.left?this.left.find(e):this.nodeValueComparator.greaterThan(e,this.value)&&this.right?this.right.find(e):null}},{key:"remove",value:function(e){var t=this.find(e);if(!t)throw new Error("Item not found in the tree");var n,i,r=t.parent;return t.left||t.right?t.left&&t.right?(n=t.right.findMin().value,this.nodeValueComparator.equal(n,t.right.value)?(t.setValue(t.right.value),t.setRight(t.right.right)):(t.setValue(n),t.right.remove(n))):(i=t.left||t.right,X.copyNode(i,t)):r?r.removeChild(t):t.setValue(null),!0}},{key:"findMin",value:function(){return this.left?this.left.findMin():this}},{key:"findMax",value:function(){return this.right?this.right.findMax():this}},{key:"getLeft",value:function(){if(this.left)return this.left.findMax();for(var e=this,t=e.parent;t;){if(t.right===e)return t;t=(e=t).parent}return null}},{key:"getRight",value:function(){if(this.right)return this.right.findMin();for(var e=this,t=e.parent;t;){if(t.left===e)return t;t=(e=t).parent}return null}}]),r}(),$=function(){function t(e){o(this,t),this.root=new Q(null,e)}return s(t,[{key:"insert",value:function(e){return this.root.insert(e)}},{key:"remove",value:function(e){return this.root.remove(e)}},{key:"find",value:function(e){return this.root.find(e)}},{key:"traverseCallback",value:function(e){return this.root.traverseInOrderCallback(e)}},{key:"traverse",value:function(){return this.root.traverseInOrder()}},{key:"getLeft",value:function(e){var t=this.find(e);if(!t)throw new Error("Item not found in the tree");return t.getLeft()}},{key:"getRight",value:function(e){var t=this.find(e);if(!t)throw new Error("Item not found in the tree");return t.getRight()}},{key:"contains",value:function(e){return!!this.find(e)}},{key:"toString",value:function(){return this.root.traverseInOrder().toString()}},{key:"findLCA",value:function(e,t,n){var i=2<arguments.length&&void 0!==n?n:this.root;if(null===i)return null;if(i.value===e||i.value===t)return i;var r=this.findLCA(e,t,i.left),o=this.findLCA(e,t,i.right);return r&&o?i:r||o}},{key:"isEmpty",value:function(){return null===this.root.value}},{key:"rangeQuery",value:function(e,t,n){var i=2<arguments.length&&void 0!==n?n:this.root;if(null===i)return[];var r=[],o=this.findSplitNode(e,t,i);if(o.left||o.right){for(var a=o.left;a.left||a.right;)a=this.nodeValueComparator.lessThan(a.value,e)?a.right:(r.push.apply(r,p(a.right.traverseInOrder())),a.left);this.nodeValueComparator.lessThan(a.value,e)||this.nodeValueComparator.greaterThan(a.value,t)||r.push(a.value);for(var s=o.right;s.left||s.right;)this.nodeValueComparator.greaterThan(s.value,t)?s=s.left:r.push.apply(r,p(s.left.traverseInOrder()));this.nodeValueComparator.lessThan(s.value,e)||this.nodeValueComparator.greaterThan(s.value,t)||r.push(s.value)}else this.nodeValueComparator.lessThan(o.value,e)||this.nodeValueComparator.greaterThan(o.value,t)||r.push(o.value);return r}},{key:"findSplitNode",value:function(e,t,n){for(var i=2<arguments.length&&void 0!==n?n:this.root;(i.left||i.right)&&(this.nodeValueComparator.lessThan(i.value,e)||this.nodeValueComparator.greaterThan(i.value,t));)i=this.nodeValueComparator.lessThan(i.value,e)?i.right:i.left;return i}}]),t}(),K=[],ee=function(){function i(e,t,n){o(this,i),this.point=e,this.type=t,this.segments=n}return s(i,null,[{key:"comparator",value:function(e,t){return m(e.point,t.point)}}]),i}(),te=function(){function t(e){o(this,t),this.segment=e,this.compareValue=m(e.begin,e.end)<0?e.begin.y:e.end.y}return s(t,[{key:"update",value:function(e){var t=new L({x:e,y:-1e5},{x:e,y:1e5});this.compareValue=this.segment.intersect(t).y}},{key:"toString",value:function(){return JSON.stringify(this)}}],[{key:"comparator",value:function(e,t){var n=e.compareValue-t.compareValue;if(Math.abs(n)>w)return n;if(e.segment===t.segment)return 0;var i,r=e.segment,o=t.segment,a=m(r.begin,r.end)<0?(i=r.end,r.begin):(i=r.begin,r.end);return I(a,i,m(o.begin,o.end)<0?o.end:o.begin)?-1:1}}]),t}();function ne(e,r,o){var t,n=r.segment,i=o.segment,a=K.find(function(e){var t=k(e.segments,2),n=t[0],i=t[1];return n===r&&i===o||n===o&&i===r});void 0!==a&&-1!==a||!n.intersectProp(i)||(t=new ee(n.intersect(i),"intersect",[r,o]),e.insert(t),K.push(t))}function ie(e,t){e.traverseCallback(function(e){e.value.update(t.point.x)})}function re(e){return JSON.parse(JSON.stringify(e))}var oe=function(){function n(e,t){o(this,n),this.edge=e,this.helper=t,this.compareValue=this.edge.begin.y}return s(n,[{key:"update",value:function(e){var t=new j({x:e,y:0},{x:0,y:1});this.compareValue=t.intersectSegment(this.edge).y}}],[{key:"comparator",value:function(e,t){var n=e.compareValue-t.compareValue;return Math.abs(n)>w?n:0}}]),n}();function ae(e,t){var n=new L(t.vertex.coord,t.vertex.incidentEdge.end.coord);e.insert(new oe(n,t))}function se(e,t,n){var i=t.incidentEdge.incidentFace,r=new Z(t);r.prev=t.incidentEdge.prev,(t.incidentEdge.prev.next=r).next=n.incidentEdge;var o=new Z(n);o.prev=n.incidentEdge.prev,(n.incidentEdge.prev.next=o).next=t.incidentEdge,t.incidentEdge.prev=o,n.incidentEdge.prev=r,t.incidentEdge=r,n.incidentEdge=o,(r.twin=o).twin=r,e.insertHalfEdge(r),e.insertHalfEdge(o);var a=new W(r),s=new W(o);e.removeFace(i),e.insertFace(a),e.insertFace(s)}function he(e){for(var t,n,i,r,o,a=e.vertices.slice(0,-1),s=new U(a,{needInit:!0}),h=function(e){for(var t,n,i,r=[],o=e.length,a=0;a<o;a++)t=0===a?o-1:a-1,n=a===o-1?0:a+1,i=e[a].coord.x<e[t].coord.x&&e[a].coord.x<e[n].coord.x?_(e[t].coord,e[a].coord,e[n].coord)?"start":"split":e[a].coord.x>e[t].coord.x&&e[a].coord.x>e[n].coord.x?_(e[t].coord,e[a].coord,e[n].coord)?"end":"merge":e[a].coord.x>e[t].coord.x&&e[a].coord.x<e[n].coord.x?"lowerRegular":"upperRegular",r[a]={vertex:e[a],type:i};return r.sort(function(e,t){return e.vertex.coord.x-t.vertex.coord.x}),r}(s.vertices),u=new $(oe.comparator);0<h.length;)switch(function(e,t){e.traverseCallback(function(e){e.value.update(t.x)})}(u,n=(t=h.shift()).vertex.coord),t.type){case"start":ae(u,t);break;case"end":"merge"===(i=u.find({compareValue:n.y}).value).helper.type&&se(s,t.vertex,i.helper.vertex),u.remove(i);break;case"split":ae(u,t),i=u.getLeft({compareValue:n.y}).value,se(s,t.vertex,i.helper.vertex),i.helper=t;break;case"merge":"merge"===(r=u.find({compareValue:n.y}).value).helper.type&&se(s,t.vertex,r.helper.vertex),"merge"===(o=u.getLeft({compareValue:n.y}).value).helper.type&&se(s,t.vertex,o.helper.vertex),u.remove(r),o.helper=t;break;case"lowerRegular":"merge"===(i=u.find({compareValue:n.y}).value).helper.type&&se(s,t.vertex,i.helper.vertex),u.remove(i),ae(u,t);break;case"upperRegular":ae(u,t),"merge"===(i=u.getLeft({compareValue:n.y}).value).helper.type&&se(s,t.vertex,i.helper.vertex),i.helper=t,u.remove({compareValue:n.y});break;default:throw new Error("Event Type Error")}return s.faces.map(function(e){return e.getVertices()})}var ue=new B,ce=[];function le(e,t,n){var i=t.origin.coord,r=t.end.coord;if(!i)return"right"===n?!e.left(r)&&e.intersectRay(new j(r,t.twin.direction)):!e.right(r)&&e.intersectRay(new j(r,t.twin.direction));if(!r)return"left"===n?!e.left(i)&&e.intersectRay(new j(i,t.direction)):!e.right(i)&&e.intersectRay(new j(i,t.direction));var o=new L(i,r);return"right"===n?!e.right(i)&&e.intersectSegProp(o):("left"!==n||!e.left(i))&&e.intersectSegProp(o)}function fe(e,t){var n=t.origin.coord,i=t.end.coord;if(!n)return e.intersectRay(new j(i,t.twin.direction));if(!i)return e.intersectRay(new j(n,t.direction));var r=new L(n,i);return e.intersectSegment(r)}function ge(e,t,n){for(var i,r,o,a,s=t.getEdges(),h=j.bisect(t.site,e),u=0;u<s.length;u++)if(le(h,s[u],"right")){i=s[u];break}if(void 0===i){for(var c=0;c<s.length;c++)if(le(h,s[c],"left")){r=s[c];break}i=r.twin,h=j.bisect(i.incidentFace.site,e)}if(void 0===i)throw Error("Intersect edge not found: ".concat(e,", ").concat(t));var l,f=[],g=new B(fe(h,i));n.insertVertex(g);for(var v=i.twin,d=g;i;){for(r=i.next;r!==i&&!le(h,r,"left");)r=r.next;if(r===i){(o=new Z(g)).direction=h.direction,g.incidentEdge=o,n.insertHalfEdge(o),(a=new Z(ue)).direction=h.direction.copy().rotateZ(Math.PI),a.incidentFace=i.incidentFace,(a.twin=o).twin=a,i.incidentFace.outerComponent=a,n.insertHalfEdge(a);for(var p=i.prev;p.end.coord;)n.removeVertex(p.origin),n.removeHalfEdge(p),p=p.prev;for(i.origin=g,(a.next=i).prev=a;i.end.coord;)i=i.next;(a.prev=i).next=a,f.push({splitEdge:o});break}if(l=new B(fe(h,r)),n.insertVertex(l),f.push({rightIntersectEdge:i,leftIntersectEdge:r,rightVertex:g,leftVertex:l}),r===v)break;i=r.twin,g=l,h=j.bisect(i.incidentFace.site,e)}if(r!==v)for(r=v,l=d;r;){for(h=j.bisect(r.incidentFace.site,e),i=r.next;i!==r&&!le(h,i,"right");)i=i.next;if(r===i){(o=new Z(ue)).direction=h.direction,n.insertHalfEdge(o),(a=new Z(l)).direction=h.direction.copy().rotateZ(Math.PI),(g.incidentEdge=a).incidentFace=r.incidentFace,(a.twin=o).twin=a,r.incidentFace.outerComponent=a,n.insertHalfEdge(a);for(var y=r.next;y.origin.coord;)n.removeVertex(y.origin),n.removeHalfEdge(y),y=y.next;for(r.twin.origin=l,(a.prev=r).next=a;r.origin.coord;)r=r.prev;(a.next=r).prev=a,f.push({splitEdge:o});break}g=new B(fe(h,i)),n.insertVertex(g),f.unshift({rightIntersectEdge:i,leftIntersectEdge:r,rightVertex:g,leftVertex:l}),r=i.twin,l=g}f.forEach(function(e){e.splitEdge||(e.splitEdge=function(e,t){var n=e.rightIntersectEdge,i=e.leftIntersectEdge,r=e.rightVertex,o=e.leftVertex,a=new Z(r);(r.incidentEdge=a).incidentFace=n.incidentFace,a.direction=n.direction,t.insertHalfEdge(a);var s=new Z(i.origin);(i.origin.incidentEdge=s).incidentFace=n.incidentFace,s.direction=n.direction,t.insertHalfEdge(s);var h=new Z(o);(o.incidentEdge=h).incidentFace=n.incidentFace,h.incidentFace.outerComponent=h,t.insertHalfEdge(h),(i.prev.next=s).prev=i.prev,(s.next=h).prev=s,(h.next=a).prev=h,a.next=n.next,(n.next.prev=a).twin=n.twin,n.twin.twin=a,s.twin=i.twin,i.twin.twin=s;var u=new Z(r);return(u.twin=h).twin=u,t.insertHalfEdge(u),u}(e,n))}),function(e,t,n){for(var i,r=e.map(function(e){return e.splitEdge}),o=0;o<r.length;o++)i=0===o?r.length-1:o-1,r[o].prev=r[i],r[i].next=r[o];var a=new W(r[0]);a.site=t,n.insertFace(a)}(f,e,n),function(e,t){for(var n,i,r=0;r<e.length;r++){var o=e[r],a=o.leftIntersectEdge,s=o.rightIntersectEdge;if(a&&s)for(n=a.next,i=s.next,t.removeHalfEdge(a);n!==i;)t.removeVertex(n.origin),t.removeHalfEdge(n),n=n.next}}(f,n)}function ve(e,t,n,i){e.prev=t,(e.next=t).prev=e,t.next=e;var r=new W(e);r.site=n,i.insertHalfEdge(e),i.insertHalfEdge(t),i.insertFace(r)}function de(e,t){var n=new L(e.origin.coord,e.next.origin.coord);if(t.origin.coord&&t.end.coord)return n.intersectProp(new L(t.origin.coord,t.end.coord));var i=t.origin.coord?new j(t.origin.coord,t.direction):new j(t.end.coord,t.twin.direction);return i.rayIntersectSegment(n)}function pe(r,e){for(var o=[],t=0;t<e.vertices.length-1;t++){var n=new Z(new B(e.vertices[t]));o.push(n)}for(var a,s,h,u,i=0;i<o.length;i++){var c=0===i?o.length-1:i-1,l=i===o.length-1?0:i+1;o[i].prev=o[c],o[i].next=o[l]}for(var f=r.halfEdges.reverse().filter(function(e){return void 0===e.origin.coord}).find(function(t){return!!(h=o.find(function(e){return de(e,t)}))}),g=f,v=function(){var t=g.next;for(t.twin||(console.log(r),console.log(t));t&&!(u=o.find(function(e){return de(e,t)}));)t=t.next;s=t.twin,a=function(e,t){var n=new L(e.origin.coord,e.next.origin.coord);if(t.origin.coord&&t.end.coord)return n.intersect(new L(t.origin.coord,t.end.coord));var i=t.origin.coord?new j(t.origin.coord,t.direction):new j(t.end.coord,t.twin.direction);return i.rayIntersectSegment(n)}(u,s);var e=new B(a);(s.origin=e).incidentEdge=s,r.insertVertex(e);var n=new Z(e);if(n.incidentFace=g.incidentFace,g.incidentFace.outerComponent=n,(t.next=n).prev=t,r.insertHalfEdge(n),h===u)(n.next=g).prev=n;else{for(t=u.next;t!==h.next;){e=new B(t.origin.coord);var i=new Z(e);e.incidentEdge=i,n.incidentFace=g.incidentFace,(n.next=i).prev=n,n=i,r.insertVertex(e),r.insertHalfEdge(i),t=t.next}(n.next=g).prev=n}h=u,g=s};s!==f;)v()}var ye=function(){function r(e,t,n,i){o(this,r),this.point=e,"circle"===(this.type=t)&&(this.arcNode=n,this.centerPoint=i)}return s(r,null,[{key:"comparator",value:function(e,t){return m(e.point,t.point)}}]),r}(),xe=function e(t,n){o(this,e),this.site=t,this.face=n,this.prevArcNode=null,this.nextArcNode=null},we=function(){function n(e,t){o(this,n),this.halfEdge=e,this.breakPoint=t}return s(n,[{key:"update",value:function(e,t,n){var i=2*(e.x-n),r=1/i,o=-2*e.y/i,a=(Math.pow(e.x,2)+Math.pow(e.y,2)-Math.pow(n,2))/i,s=r-1/(i=2*(t.x-n)),h=o- -2*t.y/i,u=a-(Math.pow(t.x,2)+Math.pow(t.y,2)-Math.pow(n,2))/i,c=Math.pow(h,2)-4*s*u,l=(-h+Math.sqrt(c))/(2*s),f=(-h-Math.sqrt(c))/(2*s),g=e.x>t.x?Math.max(l,f):Math.min(l,f),v=r*Math.pow(g,2)+o*g+a;this.breakPoint=new R(v,g)}}]),n}();function me(e,t){if(t instanceof we)return b(e.breakPoint,t.breakPoint);if(t instanceof xe)return 0;throw TypeError("statusComparator argument is BreakPoint or Arc")}function be(e,i){e.traverseCallback(function(e){if(!(e.value instanceof xe)){var t=e.left.findMax(),n=e.right.findMin();if(!t||!n)throw Error("Status tree struct mistake, can not found breack node linked arc node:");e.value.update(t.value.site,n.value.site,i.point.x)}})}function ke(e,t,n,i,r){var o,a,s,h,u,c,l=t.value.site;P(e,l,n)&&(o=j.bisect(l,e),a=j.bisect(l,n),h=(s=o.intersect(a)).distanceTo(l),(u=new R(s.x+h,s.y)).x>=r&&(c=new ye(u,"circle",t,s),t.value.circleEvent=c,i.insert(c)))}e.Animation=f,e.CanvasRender=J,e.DCEL=U,e.Geometry=D,e.clipVoronoi=pe,e.convexIntersect=function(e,t,n){for(var i,r,o,a,s,h,u,c,l=[],f=new R(0,0),g=e.vertices.slice(0,-1),v=t.vertices.slice(0,-1),d=g.length,p=v.length,y=null,x=0,w=0,m=0,b=0;m<2*d&&b<2*p;){if(r=g[x],a=v[w],i=g[(x+d-1)%d],o=v[(w+p-1)%p],s=E(f,new R(r.x-i.x,r.y-i.y),new R(a.x-o.x,a.y-o.y)),h=E(o,a,r),u=E(i,r,a),null!==(c=new L(i,r).intersect(new L(o,a)))){if(0<l.length&&c.equal(l[0])){l.push(c);break}l.push(c),0<h?y="p":0<u&&(y="q")}if(0===s&&h<0&&u<0)return null;s===u===h===0?"p"===y?(w=(w+1)%p,b+=1):(x=(x+1)%d,m+=1):0<=s&&0<u||s<0&&h<=0?("p"===y&&l.push(r),x=(x+1)%d,m+=1):(0<=s&&u<=0||s<0&&0<h)&&("q"===y&&l.push(a),w=(w+1)%p,b+=1),Array.isArray(n)&&n.push({currentEdges:[new L(i,r),new L(o,a)],intersectPolygon:new H(l)})}return l.length<=2?null:new H(l)},e.earTriangulate=function(e){for(var t,n,i,r,o=e.vertices.slice(0,-1),a=[],s=0;3<o.length;)t=s-1==-1?o.length-1:s-1,n=s+1===o.length?0:s+1,i=t-1==-1?o.length-1:t-1,r=n+1===o.length?0:n+1,s=S(o[i],o[t],o[s],o[n])&&S(o[s],o[n],o[r],o[t])&&A(o,o[t],o[n])?(a.push([o[t],o[s],o[n]]),o.splice(s,1),s===o.length?0:s):n;return 3===o.length&&a.push(o),a},e.grahamScanCH=function(e,t){var n,i=[],r=M(e);for(i.push(r.shift()),i.push(r.shift());0<r.length;)I(i[(n=i.length)-2],i[n-1],r[0])?i.push(r.shift()):i.pop(),t&&Array.isArray(t)&&t.push({vertice:r[0],chVertices:i.map(function(e){return new R(e.x,e.y)})});return i},e.halfplanesVD=function(i,e){for(var t,r,o,a,s,h,u,c=[],l=e.minX,f=e.maxX,g=e.minY,v=e.maxY,n=function(n){(t=i.slice()).splice(n,1),o=[new R(2*f-i[n].x,i[n].y),new R(i[n].x,2*v-i[n].y),new R(2*l-i[n].x,i[n].y),new R(i[n].x,2*g-i[n].y)],t.push.apply(t,p(o)),r=t.filter(function(e){return e.x<=i[n].x}),a=t.filter(function(e){return e.x>i[n].x}),r.sort(function(e,t){return E(i[n],t,e)}),a.sort(function(e,t){return E(i[n],t,e)}),t=r.concat(a);for(var e=0;e<t.length;e++)u=e===t.length-1?0:e+1,C(i[n],t[e],t[u])&&!V(t[e],t[u],i[n])&&(i[n].distanceTo(t[e])<=i[n].distanceTo(t[u])?t.splice(u,1):t.splice(e,1),--e);s=t.map(function(e){return j.bisect(e,i[n])}),h=function(e){if(e.length<2)return{lines:e.slice(),points:[]};var t,n=e.slice(),i=[];i.push(n[0].intersect(n[1]));for(var r,o,a=n.length-2;0<a;a--){for(;0<=i.length&&(t=n[i.length].intersect(n[i.length+1]),1<i.length?P(i[i.length-2],i[i.length-1],t):1===i.length&&n[0].right(t));)n.splice(i.length,1),i.pop();i.push(t)}for(;1<i.length;){if(t=n[n.length-1].intersect(n[0]),r=P(i[i.length-2],i[i.length-1],t),o=P(t,i[0],i[1]),!r&&!o){i.push(t);break}r&&(n.pop(),i.pop()),o&&(n.shift(),i.shift())}return{lines:n,points:i}}(s),c.push(h)},d=0;d<i.length;d++)n(d);return c},e.incrementalCH=function(e,t){if(!(Array.isArray(e)&&t instanceof R))throw new TypeError("Paramters Type Error");if(e.length<2)e.push(t);else if(2===e.length)e.push(t),I.apply(N,p(e))||e.reverse();else{var n=[];e.unshift(e[e.length-1]),e.push(e[1]);for(var i=1;i<e.length-1;i++)I(e[i],e[i+1],t)?n.push(e[i]):I(e[i-1],e[i],t)&&(n.push(e[i]),n.push(t));e.splice.apply(e,[0,e.length].concat(n))}return e},e.incrementalVD=function(e,t){var n,i,r,o,a,s,h,u,c,l,f,g,v;0===t.faces.length&&ce.length<2?ce.push(e):0===t.faces.length&&2===ce.length?(I(r=ce[0],i=ce[1],e)&&(i=(n=[r,i])[0],r=n[1]),o=j.bisect(r,e),a=j.bisect(e,i),s=j.bisect(i,r),h=new B(o.intersect(a)),t.insertVertex(h),(u=new Z(h)).direction=o.direction,h.incidentEdge=u,(c=new Z(ue)).direction=o.direction.copy().rotateZ(Math.PI),(u.twin=c).twin=u,(l=new Z(ue)).direction=a.direction.copy().rotateZ(Math.PI),(f=new Z(h)).direction=a.direction,(l.twin=f).twin=l,(g=new Z(h)).direction=s.direction,(v=new Z(ue)).direction=s.direction.copy().rotateZ(Math.PI),(g.twin=v).twin=g,ve(u,l,e,t),ve(f,v,i,t),ve(g,c,r,t),ce.length=0):ge(e,function(e,t,n){for(var i,r,o,a,s=2<arguments.length&&void 0!==n?n:1e4,h=0,u=t,c=e.distanceTo(u.site);u;){o=Number.POSITIVE_INFINITY,a=u.getAdjacentFaces();for(var l=0;l<a.length;l++)(i=e.distanceTo(a[l].site))<o&&(o=i,r=a[l]);if(c<=o)return u;if(c=o,u=r,s<(h+=1))throw Error("Traverse out of tolerance")}throw Error("Not found nearest neighbour face(site)")}(e,t.faces[t.faces.length-1]),t)},e.segmentsIntersect=function(e,t){var n,i,r,o,a,s,h,u,c,l,f,g,v,d,p,y,x,w,m=(s=[],e.forEach(function(e){r=new te(e),a=e.begin.x<e.end.x||e.begin.x===e.end.x&&e.begin.y<e.end.y?(o=e.begin,e.end):(o=e.end,e.begin),s.push(new ee(o,"leftEnd",[r])),s.push(new ee(a,"rightEnd",[r]))}),new G(s,0,ee.comparator)),b=new $(te.comparator);K.length=0;try{for(;0<m.length;){"leftEnd"===(g=m.pop()).type?(ie(b,g),h=k(g.segments,1)[0],b.insert(h),n=b.getLeft(h),i=b.getRight(h),n&&ne(m,h,n.value),i&&ne(m,h,i.value)):"rightEnd"===g.type?(ie(b,g),h=k(g.segments,1)[0],n=b.getLeft(h),i=b.getRight(h),n&&i&&ne(m,n.value,i.value),b.remove(h)):(l=c=void 0,te.comparator(g.segments[0],g.segments[1])<0?(c=(u=k(g.segments,2))[0],l=u[1]):(l=(f=k(g.segments,2))[0],c=f[1]),n=b.getLeft(c),(i=b.getRight(l))&&ne(m,c,i.value),n&&ne(m,l,n.value),d=c,p=l,x=y=void 0,y=(v=b).find(d),x=v.find(p),w=y.value,y.value=x.value,x.value=w,ie(b,g)),t&&Array.isArray(t)&&t.push({event:re(g),statusTree:re(b.traverse()),intersections:re(K)})}}catch(e){console.log("Erro："),console.log(e)}return K},e.sweepVD=function(e,t){for(var n,i,r,o,a,s,h,u,c,l,f,g,v,d,p,y,x,w,m,b,k,E,C,_=(n=e.map(function(e){return new ye(e,"site")}),new G(n,0,ye.comparator)),T=new $(me),P=new U;0<_.length;)"site"===(i=_.pop()).type?(be(T,i),r=i,o=_,a=T,s=P,C=E=k=x=y=p=d=v=g=c=u=h=void 0,(C=new W).site=r.point,s.insertFace(C),a.isEmpty()?a.insert(new xe(r.point,C)):((u=(h=a.find(new we(null,r.point))).value).circleEvent&&(u.circleEvent.type="falseAlarm"),c=j.bisect(u.site,r.point),l=(r.point.y-c.origin.y)/c.direction.y,f=c.getPoint(l),g=new Z(new B(f)),v=new Z(new B(f)),((g.twin=v).twin=g).incidentFace=u.face,u.face.outerComponent||(u.face.outerComponent=g),(v.incidentFace=C).outerComponent=v,s.insertHalfEdge(g),s.insertHalfEdge(v),d=new xe(u.site,u.face),p=new xe(u.site,u.face),y=new xe(r.point,C),x=new Q(new we(v,f),me),w=new Q(d,me),m=new Q(p,me),b=new Q(y,me),h.setValue(new we(g,f)),h.setLeft(w),h.setRight(x),x.setLeft(b),x.setRight(m),d.prevArcNode=u.prevArcNode,d.nextArcNode=b,y.prevArcNode=w,y.nextArcNode=m,p.prevArcNode=b,p.nextArcNode=u.nextArcNode,k=u.prevArcNode,E=u.nextArcNode,k&&(k.value.nextArcNode=w,ke(k.value.site,w,r.point,o,r.point.x)),E&&(E.value.prevArcNode=m,ke(r.point,m,E.value.site,o,r.point.x)))):"circle"===i.type&&function(e,t,n,i){var r=e.arcNode,o=e.centerPoint,a=r.value,s=a.prevArcNode,h=a.nextArcNode;s.value.circleEvent&&(s.value.circleEvent.type="falseAlarm"),h.value.circleEvent&&(h.value.circleEvent.type="falseAlarm");var u=s.value.prevArcNode,c=h.value.nextArcNode;u&&ke(u.value.site,s,h.value.site,t,e.point.x),c&&ke(s.value.site,h,c.value.site,t,e.point.x),(s.value.nextArcNode=h).value.prevArcNode=s;var l=new B(o),f=new Z(l),l=new B(o),g=new Z(l);l.incidentEdge=g,((f.twin=g).twin=f).incidentFace=s.value.face,g.incidentFace=h.value.face,i.insertHalfEdge(f),i.insertHalfEdge(g),i.insertVertex(l);var v=n.findLCA(s.value,a),d=n.findLCA(a,h.value);if(!v||!d)throw Error("Status tree struct mistake, can not found two arc node linked breack node:");var p=v.value.halfEdge,y=d.value.halfEdge;p.origin=l,y.origin=l,(((p.prev=f).next=p).twin.next=y).prev=p.twin,(y.twin.next=g).prev=y.twin;var x=r.parent,w=r.sibling();if(x===d)v.value.halfEdge=f;else{if(x!==v)throw Error("Update break node halfEdge error");d.value.halfEdge=f}if(x.isRight())x.parent.setRight(w);else{if(!x.isLeft())throw Error("circle event linked node struct error");x.parent.setLeft(w)}}(i,_,T,P);return"site"!==i.type&&be(T,i),T.traverseCallback(function(e){var t,n,i,r;e.value instanceof we&&(n=(t=e.value).breakPoint,r=(i=t.halfEdge).end.coord,i.origin=new B,i.twin.direction=new z(n.x-r.x,n.y-r.y).normalize())}),t&&pe(P,t),P},e.trapezoidTriangulate=function(e,t){var n=[],i=he(e);return Array.isArray(t)&&t.push.apply(t,p(i.slice())),i.forEach(function(e){n.push.apply(n,p(function(e){for(var t,n,i,r=e.length,o=[],a=0;a<r;a++)t=0===a?r-1:a-1,n=a===r-1?0:a+1,i=e[a].x>e[t].x&&e[a].x<e[n].x?"lower":"upper",o.push({vertex:e[a],type:i});o.sort(function(e,t){return e.vertex.x-t.vertex.x});var s,h,u,c=[],l=o.slice(0,2);for(a=2;a<r-1;a++)if((s=l.pop()).type===o[a].type){for(;0<l.length;){if(h=l.pop(),!("upper"===s.type?T(o[a].vertex,s.vertex,h.vertex):T(h.vertex,s.vertex,o[a].vertex))){l.push(h,s);break}if(u="upper"===s.type?[o[a].vertex,s.vertex,h.vertex]:[o[a].vertex,h.vertex,s.vertex],c.push(u),s=h,0===l.length){l.push(h);break}}l.push(o[a])}else{for(;0<l.length;)u="upper"===(h=l.pop()).type?[o[a].vertex,s.vertex,h.vertex]:[o[a].vertex,h.vertex,s.vertex],c.push(u),s=h;l.push(o[a-1],o[a])}for(a=0;a<l.length-1;a++)u="uppper"===l[a].type?[o[r-1].vertex,l[a+1].vertex,l[a].vertex]:[o[r-1].vertex,l[a].vertex,l[a+1].vertex],c.push(u);return c}(e)))}),n},e.upperLowerCH=function(e){for(var t,n,i=[],r=[],o=e.slice().sort(function(e,t){return e.x-t.x||e.x===t.x&&e.y-t.y}),a=o.length-1;0<=a;)(t=i.length)<2||I(i[t-2],i[t-1],o[a])?(i.push(o[a]),--a):i.pop();for(a=0;a<o.length;)(n=r.length)<2||I(r[n-2],r[n-1],o[a])?(r.push(o[a]),a+=1):r.pop();return r.shift(),r.pop(),i.concat(r)},Object.defineProperty(e,"__esModule",{value:!0})});
