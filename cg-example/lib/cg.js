!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).CG={})}(this,function(e){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function t(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function v(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n,i;t=r,i=o[n=e],n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=r(n);return h(this,i?(e=r(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var f=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,n),this.callback=e,this.options=t,this._playing=!1,this._step=-1}return s(n,[{key:"_setTimeout",value:function(){var e=this.options.frameDuration;this._requestId=e?window.setTimeout(this._anim.bind(this),e):window.requestAnimationFrame(this._anim.bind(this))}},{key:"_clearTimeout",value:function(){this.options.frameDuration?window.clearTimeout(this._requestId):window.cancelAnimationFrame(this._requestId)}},{key:"_anim",value:function(){var e=this.options,t=e.frameCount,n=e.recycle;if(t&&this._step>=t-1?this._step=0:this._step+=1,this.callback(this._step),!1===n&&t&&this._step===t-1)return this._playing=!1,void(this._step=-1);this._playing&&this._setTimeout()}},{key:"start",value:function(){this._playing||(this._setTimeout(),this._playing=!0)}},{key:"stop",value:function(){this._clearTimeout(),this._playing=!1,this._step=-1}},{key:"pause",value:function(){this._playing&&(this._clearTimeout(),this._playing=!1)}},{key:"reset",value:function(){this._clearTimeout(),this._playing=!1,this._step=-1,this.callback(this._step)}},{key:"setStep",value:function(e){var t=this.options.frameCount,n=Number.parseInt(e,10);!this._playing&&t&&-1<n&&n<t&&(this._step=n,this.callback(this._step))}},{key:"next",value:function(){var e=this.options.frameCount;this._playing||(e&&this._step>=e-1?this._step=0:this._step+=1,this.callback(this._step))}},{key:"prev",value:function(){var e=this.options.frameCount;this._playing||(this._step<=0?this._step=e?e-1:0:--this._step,this.callback(this._step))}}]),n}(),g=3,d="#ca562c",y=2,x="#3969AC",w={width:2,strokeColor:"#008080",fillColor:"#b4c8a8"},m=1e-10;function b(e,t){return e.equal(t)?0:e.x<t.x||e.x===t.x&&e.y<t.y?-1:1}function k(e,t){return e.equal(t)?0:e.y<t.y||e.y===t.y&&e.x<t.x?-1:1}function E(e,t,n){return e.x*t.y-e.y*t.x+t.x*n.y-t.y*n.x+n.x*e.y-n.y*e.x}function C(e,t,n){return Math.abs(E(e,t,n))<m}function T(e,t,n){return 0<E(e,t,n)}function _(e,t,n){return 0<=E(e,t,n)}function V(e,t,n){return E(e,t,n)<0}function P(e,t,n){var i=E(e,t,n);if(0<i)return!0;if(i<0)return!1;if(e.distanceTo(t)<e.distanceTo(n))return!0;if(e.distanceTo(t)>e.distanceTo(n))return!1;throw new Error("toLeft: Input same point")}function A(e,t,n){return 0===E(e,t,n)&&(e.x!==t.x?e.x<=n.x&&n.x<=t.x||t.x<=n.x&&n.x<=e.x:e.y<=n.y&&n.y<=t.y||t.y<=n.y&&n.y<=e.y)}function O(e,t,n,i){var r=P(t,n,i);return P(e,t,i)===r&&r===P(n,e,i)}function S(e,t,n,i){return!(e.equal(n)||e.equal(i)||t.equal(n)||t.equal(i))&&(T(e,t,n)!==T(e,t,i)&&T(n,i,e)!==T(n,i,t))}function F(e,t,n){for(var i=e.length,r=0;r<i-1;r++)if(S(e[r],e[r+1],t,n))return!1;return!(!e[i-1].equal(e[0])&&S(e[i-1],e[0],t,n))}function M(e,t,n,i){return _(t,n,e)?T(t,i,e)&&T(i,t,n):!(_(t,i,n)&&_(i,t,e))}function R(e){for(var t=0,n=1;n<e.length;n++)(e[n].y<e[t].y||e[n].y===e[t].y&&e[n].x<e[t])&&(t=n);return t}function N(e){var t=e.slice(),n=R(t),i=t[n];return t.splice(n,1),t.sort(function(e,t){return E(i,t,e)}),t.unshift(i),t}function H(e,t,n,i){var r=Math.pow(i.x,2)+Math.pow(i.y,2),o=Math.pow(e.x,2)+Math.pow(e.y,2)-r,a=Math.pow(t.x,2)+Math.pow(t.y,2)-r,s=Math.pow(n.x,2)+Math.pow(n.y,2)-r;return 0<(e.x-i.x)*(t.y-i.y)*s+(t.x-i.x)*(n.y-i.y)*o+(n.x-i.x)*(e.y-i.y)*a-(e.x-i.x)*(n.y-i.y)*a-(t.x-i.x)*(e.y-i.y)*s-(n.x-i.x)*(t.y-i.y)*o}function L(e,t,n,i){var r=e.x-i.x,o=e.y-i.y,a=e.z-i.z,s=t.x-i.x,h=t.y-i.y,c=t.z-i.z,u=n.x-i.x,l=n.y-i.y,f=n.z-i.z,g=r*(h*f-c*l)-o*(s*f-c*u)+a*(s*l-h*u);return g<-.5?-1:.5<g?1:0}var X=Object.freeze({__proto__:null,PRECISION:m,pointComparator:b,pointComparatorY:k,area2:E,areaSign:function(e,t,n){var i=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y);return i<-.5?-1:.5<i?1:0},collinear:C,left:T,leftOn:_,right:V,toLeft:P,between:A,inTriangle:O,intersectProp:S,diagonalie:F,inCone:M,LTL:R,leftSort:N,inCircumcircle:H,volumeSign:L}),Y=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;o(this,i),this.x=e,this.y=t,this.z=n}return s(i,[{key:"distanceTo",value:function(e){if(!(e instanceof i))throw new TypeError("parameter is not Point");return Math.sqrt(Math.pow(Math.abs(this.x-e.x),2)+Math.pow(Math.abs(this.y-e.y),2)+Math.pow(Math.abs(this.z-e.z),2))}},{key:"equal",value:function(e){if(!(e instanceof i))throw new TypeError("parameter is not Point");return Math.abs(this.x-e.x)<m&&Math.abs(this.y-e.y)<m&&Math.abs(this.z-e.z)<m}}]),i}(),q=function(){function a(e,t){if(o(this,a),e instanceof Y&&t instanceof Y)return this.begin=e,void(this.end=t);try{this.begin=new Y(e.x,e.y),this.end=new Y(t.x,t.y)}catch(e){throw new TypeError("Segment needs begin & end point")}}return s(a,[{key:"parallelInt",value:function(e){return 0!==E(this.begin,this.end,e.begin)?null:A(this.begin,this.end,e.begin)?e.begin:A(this.begin,this.end,e.end)?e.end:A(e.begin,e.end,this.begin)?this.begin:A(e.begin,e.end,this.end)?this.end:null}},{key:"intersect",value:function(e){if(!(e instanceof a))throw new TypeError("Not Segment");var t=this.begin.x*(e.end.y-e.begin.y)+this.end.x*(e.begin.y-e.end.y)+e.end.x*(this.end.y-this.begin.y)+e.begin.x*(this.begin.y-this.end.y);if(0==t)return this.parallelInt(e);var n=(this.begin.x*(e.end.y-e.begin.y)+e.begin.x*(this.begin.y-e.end.y)+e.end.x*(e.begin.y-this.begin.y))/t,i=-(this.begin.x*(e.begin.y-this.end.y)+this.end.x*(this.begin.y-e.begin.y)+e.begin.x*(this.end.y-this.begin.y))/t;if(n<-m||1+m<n||i<-m||1+m<i)return null;var r=this.begin.x+n*(this.end.x-this.begin.x),o=this.begin.y+n*(this.end.y-this.begin.y);return new Y(r,o)}},{key:"intersectProp",value:function(e){if(!(e instanceof a))throw new TypeError("Not Segment");return P(this.begin,this.end,e.begin)!==P(this.begin,this.end,e.end)&&P(e.begin,e.end,this.begin)!==P(e.begin,e.end,this.end)}}]),a}(),z=function(){function t(e){o(this,t),this.vertices=e.slice(),e[0]&&!e[0].equal(e[e.length-1])&&this.vertices.push(e[0])}return s(t,[{key:"area",value:function(){for(var e=this.vertices.length,t=0,n=0;n<e-1;n++)t+=(this.vertices[n].x+this.vertices[n+1].x)*(this.vertices[n+1].y-this.vertices[n].y);return t/2}}]),t}(),j=function(){function r(e,t,n,i){o(this,r),this.leftBottom=new Y(e,t),this.rightTop=new Y(n,i)}return s(r,[{key:"Intersect",value:function(e){return!(this.leftBottom.x>e.rightTop.x||this.rightTop.x<e.leftBottom.x)&&!(this.leftBottom.y>e.rightTop.y||this.rightTop.y<e.leftBottom.y)}}]),r}(),D=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;o(this,i),this.x=e,this.y=t,this.z=n}return s(i,[{key:"normalize",value:function(){var e=this.length;return new i(this.x/e,this.y/e,this.z/e)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"rotateZ",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.x,r=this.y;return this.x=i*t-r*n,this.y=i*n+r*t,this}},{key:"copy",value:function(){return new i(this.x,this.y,this.z)}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}],[{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}},{key:"cross",value:function(e,t){return new i(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}},{key:"cos",value:function(e,t){return this.dot(e.normalize(),t.normalize())}},{key:"projection",value:function(e,t){return e.copy().scale(t.length*this.cos(e,t))}}]),i}(),B=function(){function n(e,t){o(this,n);try{this.origin=new Y(e.x,e.y),this.direction=new D(t.x,t.y)}catch(e){throw new TypeError("Line need origin and direction:",e)}}return s(n,[{key:"getPoint",value:function(e){return new Y(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}},{key:"intersect",value:function(e){var t=this.getPoint(1),n=e.getPoint(1),i=this.origin.x*(n.y-e.origin.y)+t.x*(e.origin.y-n.y)+n.x*(t.y-this.origin.y)+e.origin.x*(this.origin.y-t.y);if(0==i)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var r=(this.origin.x*(n.y-e.origin.y)+e.origin.x*(this.origin.y-n.y)+n.x*(e.origin.y-this.origin.y))/i,o=this.origin.x+r*(t.x-this.origin.x),a=this.origin.y+r*(t.y-this.origin.y);return new Y(o,a)}},{key:"intersectSegProp",value:function(e){return this.right(e.begin)!==this.right(e.end)}},{key:"intersectSegment",value:function(e){var t=this.getPoint(1),n=this.origin.x*(e.end.y-e.begin.y)+t.x*(e.begin.y-e.end.y)+e.end.x*(t.y-this.origin.y)+e.begin.x*(this.origin.y-t.y);if(0==n)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var i=-(this.origin.x*(e.begin.y-t.y)+t.x*(this.origin.y-e.begin.y)+e.begin.x*(t.y-this.origin.y))/n;if(i<-m||1+m<i)throw new Error("Line not intersect segment: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var r=e.begin.x+i*(e.end.x-e.begin.x),o=e.begin.y+i*(e.end.y-e.begin.y);return new Y(r,o)}},{key:"intersectRay",value:function(e){var t=this.getPoint(1),n=e.getPoint(1),i=this.origin.x*(n.y-e.origin.y)+t.x*(e.origin.y-n.y)+n.x*(t.y-this.origin.y)+e.origin.x*(this.origin.y-t.y);if(0==i)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(seg)));var r=-(this.origin.x*(e.origin.y-t.y)+t.x*(this.origin.y-e.origin.y)+e.origin.x*(t.y-this.origin.y))/i;if(r<-m)return null;var o=e.origin.x+r*(n.x-e.origin.x),a=e.origin.y+r*(n.y-e.origin.y);return new Y(o,a)}},{key:"rayIntersectSegment",value:function(e){var t=this.getPoint(1),n=this.origin.x*(e.end.y-e.begin.y)+t.x*(e.begin.y-e.end.y)+e.end.x*(t.y-this.origin.y)+e.begin.x*(this.origin.y-t.y);if(0==n)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(e)));var i=(this.origin.x*(e.end.y-e.begin.y)+e.begin.x*(this.origin.y-e.end.y)+e.end.x*(e.begin.y-this.origin.y))/n,r=-(this.origin.x*(e.begin.y-t.y)+t.x*(this.origin.y-e.begin.y)+e.begin.x*(t.y-this.origin.y))/n;if(i<-m||r<-m||1+m<r)return null;var o=e.begin.x+r*(e.end.x-e.begin.x),a=e.begin.y+r*(e.end.y-e.begin.y);return new Y(o,a)}},{key:"right",value:function(e){return V(this.origin,this.getPoint(1),e)}},{key:"left",value:function(e){return T(this.origin,this.getPoint(1),e)}}],[{key:"bisect",value:function(e,t){if(e.equal(t))throw new Error("Input equal points");return new n(new Y((e.x+t.x)/2,(e.y+t.y)/2),new D(t.x-e.x,t.y-e.y).normalize().rotateZ(-Math.PI/2))}}]),n}(),J=Object.freeze({__proto__:null,Util:X,Point:Y,Segment:q,Polygon:z,Rectangle:j,Line:B,Vector:D}),K=function(){function i(e){o(this,i),this.canvas=e;var t=Math.max(window.devicePixelRatio||2,2),n=this.canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.canvas.width=n.width*t,this.canvas.height=n.height*t,this.ctx=e.getContext("2d"),this.ctx.scale(t,t),this.ctx.lineJoin="round"}return s(i,[{key:"clearCanvas",value:function(){var e=this.ctx.canvas,t=e.width,n=e.height;this.ctx.clearRect(0,0,t,n)}},{key:"drawPoint",value:function(e,t,n){var i,r=1<arguments.length&&void 0!==t?t:g,o=2<arguments.length&&void 0!==n?n:d;e&&e instanceof Y&&(i=this.height,this.ctx.save(),this.ctx.lineWidth=r,this.ctx.strokeStyle=o,this.ctx.beginPath(),this.ctx.arc(e.x,i-e.y,r/2,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}},{key:"drawPoints",value:function(e,t,n){var i,r=this,o=1<arguments.length&&void 0!==t?t:g,a=2<arguments.length&&void 0!==n?n:d;Array.isArray(e)&&(i=this.height,this.ctx.save(),this.ctx.lineWidth=o,this.ctx.strokeStyle=a,this.ctx.beginPath(),e.forEach(function(e){r.ctx.moveTo(e.x,i-e.y),r.ctx.arc(e.x,i-e.y,o/2,0,2*Math.PI)}),this.ctx.stroke(),this.ctx.restore())}},{key:"drawSegment",value:function(e,t,n){var i=1<arguments.length&&void 0!==t?t:y,r=2<arguments.length&&void 0!==n?n:x,o=this.height;this.ctx.save(),void 0!==i&&(this.ctx.lineWidth=i),void 0!==r&&(this.ctx.strokeStyle=r),this.ctx.beginPath(),this.ctx.moveTo(e.begin.x,o-e.begin.y),this.ctx.lineTo(e.end.x,o-e.end.y),this.ctx.stroke(),this.ctx.restore()}},{key:"drawSegments",value:function(e,t,n){var i=this,r=1<arguments.length&&void 0!==t?t:y,o=2<arguments.length&&void 0!==n?n:x;this.ctx.save(),void 0!==r&&(this.ctx.lineWidth=r),void 0!==o&&(this.ctx.strokeStyle=o);var a=this.height;this.ctx.beginPath(),e.forEach(function(e){i.ctx.moveTo(e.begin.x,a-e.begin.y),i.ctx.lineTo(e.end.x,a-e.end.y)}),this.ctx.stroke(),this.ctx.restore()}},{key:"drawPolygon",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{style:{}},i=v({},w);Object.assign(i,n.style),this.ctx.save(),this.ctx.lineWidth=i.width,this.ctx.fillStyle=i.fillColor,this.ctx.strokeStyle=i.strokeColor;var r=e.vertices;if(r&&Array.isArray(r)&&!(r.length<1)){var o=this.height;this.ctx.beginPath(),this.ctx.moveTo(r[0].x,o-r[0].y);for(var a=1;a<r.length;a++)this.ctx.lineTo(r[a].x,o-r[a].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}}},{key:"drawPolygons",value:function(e,t){var n,i,r,o=this,a=1<arguments.length&&void 0!==t?t:{style:{}};e&&Array.isArray(e)&&(n=v({},w),Object.assign(n,a.style),this.ctx.save(),this.ctx.lineWidth=n.width,this.ctx.fillStyle=n.fillColor,this.ctx.strokeStyle=n.strokeColor,i=this.height,this.ctx.beginPath(),e.forEach(function(e){if(r=e.vertices?e.vertices:e,Array.isArray(r)&&1<r.length){o.ctx.moveTo(r[0].x,i-r[0].y);for(var t=1;t<r.length;t++)o.ctx.lineTo(r[t].x,i-r[t].y);o.ctx.closePath()}}),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore())}},{key:"drawText",value:function(e,t,n,i){var r=1<arguments.length&&void 0!==t?t:0,o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==i?i:{style:{},fill:!0},s=this.height;this.ctx.save(),a.textBaseline&&(this.ctx.textBaseline=a.textBaseline),this.ctx.font=a.font,a.fill?this.ctx.fillText(e,r,s-o):this.ctx.strokeText(e,r,s-o),this.ctx.restore()}}]),i}(),Z=function(){function n(e,t){o(this,n),this._coord=e,this._incidentEdge=t}return s(n,[{key:"incidentEdge",set:function(e){this._incidentEdge=e},get:function(){return this._incidentEdge}},{key:"coord",set:function(e){this._coord=e},get:function(){return this._coord}},{key:"incidentFaces",get:function(){for(var e=this._incidentEdge,t=e.twin.next,n=[e.incidentFace];t!==e;)n.push(t.incidentFace),t=t.twin.next;return n.filter(function(e){return!!e})}}]),n}(),W=function(){function t(e){if(o(this,t),!(e&&e instanceof Z))throw new Error("Origin must is vertex");this._origin=e}return s(t,[{key:"origin",set:function(e){this._origin=e},get:function(){return this._origin}},{key:"end",get:function(){return this.twin.origin}},{key:"direction",set:function(e){this._direction=e},get:function(){return this._direction}},{key:"twin",set:function(e){if(!(e&&e instanceof t))throw new Error("Twin must be halfEdge");this._twin=e},get:function(){return this._twin}},{key:"incidentFace",set:function(e){this._incidentFace=e},get:function(){return this._incidentFace}},{key:"next",set:function(e){if(!(e&&e instanceof t))throw new Error("Next must be halfEdge");this._next=e},get:function(){return this._next}},{key:"prev",set:function(e){if(!(e&&e instanceof t))throw new Error("Prev must be halfEdge");this._prev=e},get:function(){return this._prev}}]),t}(),U=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(o(this,i),e){if(!(e instanceof W))throw new Error("Face must has halfEdge outerComponent");e.incidentFace=this;for(var n=e.next;n&&n!==e;)n.incidentFace=this,n=n.next;this._outerComponent=e}if(!(t&&t instanceof Array))throw new Error("Face innnerComponents must is array");this._innerComponents=t}return s(i,[{key:"addInnerComponent",value:function(e){if(!(e&&e instanceof W))throw new Error("InnerComponent is HalfEdge");this._innerComponents.push(e)}},{key:"getVertices",value:function(){for(var e=this._outerComponent.next,t=[this._outerComponent.origin.coord];e&&e!==this._outerComponent;)t.push(e.origin.coord),e=e.next;return t}},{key:"getEdges",value:function(){for(var e=[this._outerComponent],t=this._outerComponent.next;t&&t!==this._outerComponent;)e.push(t),t=t.next;return e}},{key:"getAdjacentFaces",value:function(){for(var e=this._outerComponent.next,t=this._outerComponent.twin.incidentFace,n=t?[t]:[];e&&e!==this._outerComponent;)(t=e.twin.incidentFace)&&n.push(t),e=e.next;return n}},{key:"outerComponent",get:function(){return this._outerComponent},set:function(e){this._outerComponent=e}},{key:"innerComponents",get:function(){return this._innerComponents}},{key:"site",set:function(e){this._site=e},get:function(){return this._site}}]),i}();var Q=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,n),this.faces=[],this.halfEdges=[],this.vertices=[],t.needInit&&e&&Array.isArray(e)&&0<e.length&&function(e,t,n,i){for(var r,o,a,s,h,c=e.length,u=0;u<c;u++)i.push(new Z(e[u]));for(u=0;u<c;u++)s=new W(i[u]),i[u].incidentEdge=s,h=new W(i[a=u===c-1?0:u+1]),(s.twin=h).twin=s,n.push(s,h);for(u=0;u<c;u++)o=0===u?2*(c-1):2*(u-1),n[r=2*u].prev=n[o],n[o].next=n[r],a=0===u?2*(c-1)+1:2*(u-1)+1,n[r=2*u+1].next=n[a],n[a].prev=n[r];var l=new U(n[0]);t.push(l)}(e,this.faces,this.halfEdges,this.vertices)}return s(n,[{key:"removeVertex",value:function(t){var e=this.vertices.findIndex(function(e){return e===t});return-1!==e&&this.vertices.splice(e,1)}},{key:"insertVertex",value:function(){var e;(e=this.vertices).push.apply(e,arguments)}},{key:"removeHalfEdge",value:function(t){var e=this.halfEdges.findIndex(function(e){return e===t});return-1!==e&&this.halfEdges.splice(e,1)}},{key:"insertHalfEdge",value:function(){var e;(e=this.halfEdges).push.apply(e,arguments)}},{key:"removeFace",value:function(t){var e=this.faces.findIndex(function(e){return e===t});return-1!==e&&this.faces.splice(e,1)}},{key:"insertFace",value:function(){var e;(e=this.faces).push.apply(e,arguments)}}]),n}();function G(e,t,n){return e.prev=n,(e.next=t).prev=e,(t.next=n).prev=t,n.next=e,new U(e)}var $=function(){function t(e){o(this,t),this.compare=e||t.defaultCompareFunction}return s(t,[{key:"equal",value:function(e,t){return 0===this.compare(e,t)}},{key:"lessThan",value:function(e,t){return this.compare(e,t)<0}},{key:"greaterThan",value:function(e,t){return 0<this.compare(e,t)}},{key:"lessThanOrEqual",value:function(e,t){return this.lessThan(e,t)||this.equal(e,t)}},{key:"greaterThanOrEqual",value:function(e,t){return this.greaterThan(e,t)||this.equal(e,t)}},{key:"reverse",value:function(){var n=this.compare;this.compare=function(e,t){return n(t,e)}}}],[{key:"defaultCompareFunction",value:function(e,t){return e===t?0:e<t?-1:1}}]),t}(),ee=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length?arguments[2]:void 0;o(this,r),this.heapType=t,this.compareFunciont=n,this.nodeValueComparator=new $(n),this.heapContainter=e.slice();for(var i=Math.floor(this.length/2);0<=i;i--)this.heapifyDown(i)}return s(r,[{key:"inHeap",value:function(e){return 0<=e&&e<this.length}},{key:"getLeftIndex",value:function(e){return 2*e+1}},{key:"getRightIndex",value:function(e){return 2*e+2}},{key:"getParentIndex",value:function(e){return Math.floor((e-1)/2)}},{key:"getLeft",value:function(e){return this.heapContainter[this.getLeftIndex(e)]}},{key:"getRight",value:function(e){return this.heapContainter[this.getRightIndex(e)]}},{key:"getParent",value:function(e){return this.heapContainter[this.getParentIndex(e)]}},{key:"insert",value:function(e){return this.heapContainter.push(e),this.heapifyUp(),this}},{key:"pop",value:function(){if(0===this.length)return null;if(1===this.length)return this.heapContainter.pop();var e=this.heapContainter[0];return this.heapContainter[0]=this.heapContainter.pop(),this.heapifyDown(),e}},{key:"heapifyUp",value:function(e){for(var t=e||this.heapContainter.length-1,n=this.getParentIndex(t);this.inHeap(n)&&!this.isCorrectOrder(this.heapContainter[n],this.heapContainter[t]);)this.swap(t,n),t=this.getParentIndex(t),n=this.getParentIndex(t)}},{key:"heapifyDown",value:function(e){for(var t=e||0,n=this.getLeftIndex(t);this.inHeap(n)&&(this.inHeap(n+1)&&this.isCorrectOrder(this.heapContainter[n+1],this.heapContainter[n])&&(n+=1),!this.isCorrectOrder(this.heapContainter[t],this.heapContainter[n]));)this.swap(t,n),t=n,n=this.getLeftIndex(t)}},{key:"isCorrectOrder",value:function(e,t){return this.heapType?this.nodeValueComparator.greaterThanOrEqual(e,t):this.nodeValueComparator.lessThanOrEqual(e,t)}},{key:"swap",value:function(e,t){var n=this.heapContainter[e];this.heapContainter[e]=this.heapContainter[t],this.heapContainter[t]=n}},{key:"toString",value:function(){return this.heapContainter.toString()}},{key:"length",get:function(){return this.heapContainter.length}}]),r}(),te=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;o(this,n),this.left=null,this.right=null,this.parent=null,this.value=e,this.compareFunction=t,this.nodeValueComparator=new $(t)}return s(n,[{key:"setValue",value:function(e){return this.value=e,this}},{key:"setLeft",value:function(e){return this.left=e,this.left&&(this.left.parent=this),this}},{key:"setRight",value:function(e){return this.right=e,this.right&&(this.right.parent=this),this}},{key:"removeChild",value:function(e){return this.left&&this.nodeValueComparator.equal(this.left.value,e.value)?!(this.left=null):!(!this.right||!this.nodeValueComparator.equal(this.right.value,e.value))&&!(this.right=null)}},{key:"replaceChild",value:function(e,t){return!(!e||!t)&&(this.left&&this.nodeValueComparator.equal(this.left,e)?(this.left=t,!0):!(!this.right||!this.nodeValueComparator.equal(this.right,e))&&(this.right=t,!0))}},{key:"traverseInOrder",value:function(e){var t=0<arguments.length&&void 0!==e?e:[];return this.left&&this.left.traverseInOrder(t),null!==this.value&&t.push(this.value),this.right&&this.right.traverseInOrder(t),t}},{key:"traverseInOrderCallback",value:function(e){this.left&&this.left.traverseInOrderCallback(e),null!==this.value&&e(this),this.right&&this.right.traverseInOrderCallback(e)}},{key:"sibling",value:function(){return this.parent?this.parent.left===this?this.parent.right:this.parent.left:null}},{key:"isRight",value:function(){return!(!this.parent||this.parent.right!==this)}},{key:"isLeft",value:function(){return!(!this.parent||this.parent.left!==this)}},{key:"getLeafNodes",value:function(e){var t=0<arguments.length&&void 0!==e?e:[];return this.left&&this.left.getLeafNodes(t),this.right&&this.right.getLeafNodes(t),this.left||this.right||!this.value||t.push(this.value),t}},{key:"leftHight",get:function(){return this.left?this.left.height:0}},{key:"rightHight",get:function(){return this.right?this.right.height:0}},{key:"height",get:function(){return Math.max(this.leftHight,this.rightHight)+1}},{key:"balanceFactor",get:function(){return this.leftHight-this.rightHight}}],[{key:"copyNode",value:function(e,t){t.setValue(e.value),t.setLeft(e.left),t.setRight(e.right)}}]),n}(),ne=function(){n(r,te);var i=c(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length?arguments[1]:void 0;return o(this,r),(e=i.call(this,t)).compareFunction=n,e.nodeValueComparator=new $(n),e}return s(r,[{key:"insert",value:function(e){return null===this.value?(this.value=e,this):this.nodeValueComparator.lessThan(e,this.value)?this.left?this.left.insert(e):(t=new r(e,this.compareFunction),this.setLeft(t),t):this.nodeValueComparator.greaterThan(e,this.value)?this.right?this.right.insert(e):(t=new r(e,this.compareFunction),this.setRight(t),t):this;var t}},{key:"find",value:function(e){return this.nodeValueComparator.equal(e,this.value)?this:this.nodeValueComparator.lessThan(e,this.value)&&this.left?this.left.find(e):this.nodeValueComparator.greaterThan(e,this.value)&&this.right?this.right.find(e):null}},{key:"remove",value:function(e){var t=this.find(e);if(!t)throw new Error("Item not found in the tree");var n,i,r=t.parent;return t.left||t.right?t.left&&t.right?(n=t.right.findMin().value,this.nodeValueComparator.equal(n,t.right.value)?(t.setValue(t.right.value),t.setRight(t.right.right)):(t.setValue(n),t.right.remove(n))):(i=t.left||t.right,te.copyNode(i,t)):r?r.removeChild(t):t.setValue(null),!0}},{key:"findMin",value:function(){return this.left?this.left.findMin():this}},{key:"findMax",value:function(){return this.right?this.right.findMax():this}},{key:"getLeft",value:function(){if(this.left)return this.left.findMax();for(var e=this,t=e.parent;t;){if(t.right===e)return t;t=(e=t).parent}return null}},{key:"getRight",value:function(){if(this.right)return this.right.findMin();for(var e=this,t=e.parent;t;){if(t.left===e)return t;t=(e=t).parent}return null}}]),r}(),ie=function(){function t(e){o(this,t),this.root=new ne(null,e)}return s(t,[{key:"insert",value:function(e){return this.root.insert(e)}},{key:"remove",value:function(e){return this.root.remove(e)}},{key:"find",value:function(e){return this.root.find(e)}},{key:"traverseCallback",value:function(e){return this.root.traverseInOrderCallback(e)}},{key:"traverse",value:function(){return this.root.traverseInOrder()}},{key:"getLeft",value:function(e){var t=this.find(e);if(!t)throw new Error("Item not found in the tree");return t.getLeft()}},{key:"getRight",value:function(e){var t=this.find(e);if(!t)throw new Error("Item not found in the tree");return t.getRight()}},{key:"contains",value:function(e){return!!this.find(e)}},{key:"toString",value:function(){return this.root.traverseInOrder().toString()}},{key:"findLCA",value:function(e,t,n){var i=2<arguments.length&&void 0!==n?n:this.root;if(null===i)return null;if(i.value===e||i.value===t)return i;var r=this.findLCA(e,t,i.left),o=this.findLCA(e,t,i.right);return r&&o?i:r||o}},{key:"isEmpty",value:function(){return null===this.root.value}},{key:"rangeQuery",value:function(e,t,n){var i=2<arguments.length&&void 0!==n?n:this.root;if(null===i)return[];var r=[],o=this.findSplitNode(e,t,i);if(o.left||o.right){for(var a=o.left;a.left||a.right;)a=this.nodeValueComparator.lessThan(a.value,e)?a.right:(r.push.apply(r,p(a.right.traverseInOrder())),a.left);this.nodeValueComparator.lessThan(a.value,e)||this.nodeValueComparator.greaterThan(a.value,t)||r.push(a.value);for(var s=o.right;s.left||s.right;)this.nodeValueComparator.greaterThan(s.value,t)?s=s.left:r.push.apply(r,p(s.left.traverseInOrder()));this.nodeValueComparator.lessThan(s.value,e)||this.nodeValueComparator.greaterThan(s.value,t)||r.push(s.value)}else this.nodeValueComparator.lessThan(o.value,e)||this.nodeValueComparator.greaterThan(o.value,t)||r.push(o.value);return r}},{key:"findSplitNode",value:function(e,t,n){for(var i=2<arguments.length&&void 0!==n?n:this.root;(i.left||i.right)&&(this.nodeValueComparator.lessThan(i.value,e)||this.nodeValueComparator.greaterThan(i.value,t));)i=this.nodeValueComparator.lessThan(i.value,e)?i.right:i.left;return i}}]),t}(),re=[],oe=function(){function i(e,t,n){o(this,i),this.point=e,this.type=t,this.segments=n}return s(i,null,[{key:"comparator",value:function(e,t){return b(e.point,t.point)}}]),i}(),ae=function(){function t(e){o(this,t),this.segment=e,this.compareValue=b(e.begin,e.end)<0?e.begin.y:e.end.y}return s(t,[{key:"update",value:function(e){var t=new q({x:e,y:-1e5},{x:e,y:1e5});this.compareValue=this.segment.intersect(t).y}},{key:"toString",value:function(){return JSON.stringify(this)}}],[{key:"comparator",value:function(e,t){var n=e.compareValue-t.compareValue;if(Math.abs(n)>m)return n;if(e.segment===t.segment)return 0;var i,r=e.segment,o=t.segment,a=b(r.begin,r.end)<0?(i=r.end,r.begin):(i=r.begin,r.end);return P(a,i,b(o.begin,o.end)<0?o.end:o.begin)?-1:1}}]),t}();function se(e,r,o){var t,n=r.segment,i=o.segment,a=re.find(function(e){var t=I(e.segments,2),n=t[0],i=t[1];return n===r&&i===o||n===o&&i===r});void 0!==a&&-1!==a||!n.intersectProp(i)||(t=new oe(n.intersect(i),"intersect",[r,o]),e.insert(t),re.push(t))}function he(e,t){e.traverseCallback(function(e){e.value.update(t.point.x)})}function ce(e){return JSON.parse(JSON.stringify(e))}var ue=function(){function n(e,t){o(this,n),this.edge=e,this.helper=t,this.compareValue=this.edge.begin.y}return s(n,[{key:"update",value:function(e){var t=new B({x:e,y:0},{x:0,y:1});this.compareValue=t.intersectSegment(this.edge).y}}],[{key:"comparator",value:function(e,t){var n=e.compareValue-t.compareValue;return Math.abs(n)>m?n:0}}]),n}();function le(e,t){var n=new q(t.vertex.coord,t.vertex.incidentEdge.end.coord);e.insert(new ue(n,t))}function fe(e,t,n){var i=t.incidentEdge.incidentFace,r=new W(t);r.prev=t.incidentEdge.prev,(t.incidentEdge.prev.next=r).next=n.incidentEdge;var o=new W(n);o.prev=n.incidentEdge.prev,(n.incidentEdge.prev.next=o).next=t.incidentEdge,t.incidentEdge.prev=o,n.incidentEdge.prev=r,t.incidentEdge=r,n.incidentEdge=o,(r.twin=o).twin=r,e.insertHalfEdge(r),e.insertHalfEdge(o);var a=new U(r),s=new U(o);e.removeFace(i),e.insertFace(a),e.insertFace(s)}function ge(e){for(var t,n,i,r,o,a=e.vertices.slice(0,-1),s=new Q(a,{needInit:!0}),h=function(e){for(var t,n,i,r=[],o=e.length,a=0;a<o;a++)t=0===a?o-1:a-1,n=a===o-1?0:a+1,i=e[a].coord.x<e[t].coord.x&&e[a].coord.x<e[n].coord.x?T(e[t].coord,e[a].coord,e[n].coord)?"start":"split":e[a].coord.x>e[t].coord.x&&e[a].coord.x>e[n].coord.x?T(e[t].coord,e[a].coord,e[n].coord)?"end":"merge":e[a].coord.x>e[t].coord.x&&e[a].coord.x<e[n].coord.x?"lowerRegular":"upperRegular",r[a]={vertex:e[a],type:i};return r.sort(function(e,t){return e.vertex.coord.x-t.vertex.coord.x}),r}(s.vertices),c=new ie(ue.comparator);0<h.length;)switch(function(e,t){e.traverseCallback(function(e){e.value.update(t.x)})}(c,n=(t=h.shift()).vertex.coord),t.type){case"start":le(c,t);break;case"end":"merge"===(i=c.find({compareValue:n.y}).value).helper.type&&fe(s,t.vertex,i.helper.vertex),c.remove(i);break;case"split":le(c,t),i=c.getLeft({compareValue:n.y}).value,fe(s,t.vertex,i.helper.vertex),i.helper=t;break;case"merge":"merge"===(r=c.find({compareValue:n.y}).value).helper.type&&fe(s,t.vertex,r.helper.vertex),"merge"===(o=c.getLeft({compareValue:n.y}).value).helper.type&&fe(s,t.vertex,o.helper.vertex),c.remove(r),o.helper=t;break;case"lowerRegular":"merge"===(i=c.find({compareValue:n.y}).value).helper.type&&fe(s,t.vertex,i.helper.vertex),c.remove(i),le(c,t);break;case"upperRegular":le(c,t),"merge"===(i=c.getLeft({compareValue:n.y}).value).helper.type&&fe(s,t.vertex,i.helper.vertex),i.helper=t,c.remove({compareValue:n.y});break;default:throw new Error("Event Type Error")}return s.faces.map(function(e){return e.getVertices()})}var de=new Z,ve=[];function pe(e,t,n){var i=t.origin.coord,r=t.end.coord;if(!i)return"right"===n?!e.left(r)&&e.intersectRay(new B(r,t.twin.direction)):!e.right(r)&&e.intersectRay(new B(r,t.twin.direction));if(!r)return"left"===n?!e.left(i)&&e.intersectRay(new B(i,t.direction)):!e.right(i)&&e.intersectRay(new B(i,t.direction));var o=new q(i,r);return"right"===n?!e.right(i)&&e.intersectSegProp(o):("left"!==n||!e.left(i))&&e.intersectSegProp(o)}function ye(e,t){var n=t.origin.coord,i=t.end.coord;if(!n)return e.intersectRay(new B(i,t.twin.direction));if(!i)return e.intersectRay(new B(n,t.direction));var r=new q(n,i);return e.intersectSegment(r)}function xe(e,t,n){for(var i,r,o,a,s=t.getEdges(),h=B.bisect(t.site,e),c=0;c<s.length;c++)if(pe(h,s[c],"right")){i=s[c];break}if(void 0===i){for(var u=0;u<s.length;u++)if(pe(h,s[u],"left")){r=s[u];break}i=r.twin,h=B.bisect(i.incidentFace.site,e)}if(void 0===i)throw Error("Intersect edge not found: ".concat(e,", ").concat(t));var l,f=[],g=new Z(ye(h,i));n.insertVertex(g);for(var d=i.twin,v=g;i;){for(r=i.next;r!==i&&!pe(h,r,"left");)r=r.next;if(r===i){(o=new W(g)).direction=h.direction,g.incidentEdge=o,n.insertHalfEdge(o),(a=new W(de)).direction=h.direction.copy().rotateZ(Math.PI),a.incidentFace=i.incidentFace,(a.twin=o).twin=a,i.incidentFace.outerComponent=a,n.insertHalfEdge(a);for(var p=i.prev;p.end.coord;)n.removeVertex(p.origin),n.removeHalfEdge(p),p=p.prev;for(i.origin=g,(a.next=i).prev=a;i.end.coord;)i=i.next;(a.prev=i).next=a,f.push({splitEdge:o});break}if(l=new Z(ye(h,r)),n.insertVertex(l),f.push({rightIntersectEdge:i,leftIntersectEdge:r,rightVertex:g,leftVertex:l}),r===d)break;i=r.twin,g=l,h=B.bisect(i.incidentFace.site,e)}if(r!==d)for(r=d,l=v;r;){for(h=B.bisect(r.incidentFace.site,e),i=r.next;i!==r&&!pe(h,i,"right");)i=i.next;if(r===i){(o=new W(de)).direction=h.direction,n.insertHalfEdge(o),(a=new W(l)).direction=h.direction.copy().rotateZ(Math.PI),(g.incidentEdge=a).incidentFace=r.incidentFace,(a.twin=o).twin=a,r.incidentFace.outerComponent=a,n.insertHalfEdge(a);for(var y=r.next;y.origin.coord;)n.removeVertex(y.origin),n.removeHalfEdge(y),y=y.next;for(r.twin.origin=l,(a.prev=r).next=a;r.origin.coord;)r=r.prev;(a.next=r).prev=a,f.push({splitEdge:o});break}g=new Z(ye(h,i)),n.insertVertex(g),f.unshift({rightIntersectEdge:i,leftIntersectEdge:r,rightVertex:g,leftVertex:l}),r=i.twin,l=g}f.forEach(function(e){e.splitEdge||(e.splitEdge=function(e,t){var n=e.rightIntersectEdge,i=e.leftIntersectEdge,r=e.rightVertex,o=e.leftVertex,a=new W(r);(r.incidentEdge=a).incidentFace=n.incidentFace,a.direction=n.direction,t.insertHalfEdge(a);var s=new W(i.origin);(i.origin.incidentEdge=s).incidentFace=n.incidentFace,s.direction=n.direction,t.insertHalfEdge(s);var h=new W(o);(o.incidentEdge=h).incidentFace=n.incidentFace,h.incidentFace.outerComponent=h,t.insertHalfEdge(h),(i.prev.next=s).prev=i.prev,(s.next=h).prev=s,(h.next=a).prev=h,a.next=n.next,(n.next.prev=a).twin=n.twin,n.twin.twin=a,s.twin=i.twin,i.twin.twin=s;var c=new W(r);return(c.twin=h).twin=c,t.insertHalfEdge(c),c}(e,n))}),function(e,t,n){for(var i,r=e.map(function(e){return e.splitEdge}),o=0;o<r.length;o++)i=0===o?r.length-1:o-1,r[o].prev=r[i],r[i].next=r[o];var a=new U(r[0]);a.site=t,n.insertFace(a)}(f,e,n),function(e,t){for(var n,i,r=0;r<e.length;r++){var o=e[r],a=o.leftIntersectEdge,s=o.rightIntersectEdge;if(a&&s)for(n=a.next,i=s.next,t.removeHalfEdge(a);n!==i;)t.removeVertex(n.origin),t.removeHalfEdge(n),n=n.next}}(f,n)}function we(e,t,n,i){e.prev=t,(e.next=t).prev=e,t.next=e;var r=new U(e);r.site=n,i.insertHalfEdge(e),i.insertHalfEdge(t),i.insertFace(r)}function me(e,t){var n=new q(e.origin.coord,e.next.origin.coord);if(t.origin.coord&&t.end.coord)return n.intersectProp(new q(t.origin.coord,t.end.coord));var i=t.origin.coord?new B(t.origin.coord,t.direction):new B(t.end.coord,t.twin.direction);return i.rayIntersectSegment(n)}function be(r,e){for(var o=[],t=0;t<e.vertices.length-1;t++){var n=new W(new Z(e.vertices[t]));o.push(n)}for(var a,s,h,c,i=0;i<o.length;i++){var u=0===i?o.length-1:i-1,l=i===o.length-1?0:i+1;o[i].prev=o[u],o[i].next=o[l]}for(var f=r.halfEdges.reverse().filter(function(e){return void 0===e.origin.coord}).find(function(t){return!!(h=o.find(function(e){return me(e,t)}))}),g=f,d=function(){var t=g.next;for(t.twin||(console.log(r),console.log(t));t&&!(c=o.find(function(e){return me(e,t)}));)t=t.next;s=t.twin,a=function(e,t){var n=new q(e.origin.coord,e.next.origin.coord);if(t.origin.coord&&t.end.coord)return n.intersect(new q(t.origin.coord,t.end.coord));var i=t.origin.coord?new B(t.origin.coord,t.direction):new B(t.end.coord,t.twin.direction);return i.rayIntersectSegment(n)}(c,s);var e=new Z(a);(s.origin=e).incidentEdge=s,r.insertVertex(e);var n=new W(e);if(n.incidentFace=g.incidentFace,g.incidentFace.outerComponent=n,(t.next=n).prev=t,r.insertHalfEdge(n),h===c)(n.next=g).prev=n;else{for(t=c.next;t!==h.next;){e=new Z(t.origin.coord);var i=new W(e);e.incidentEdge=i,n.incidentFace=g.incidentFace,(n.next=i).prev=n,n=i,r.insertVertex(e),r.insertHalfEdge(i),t=t.next}(n.next=g).prev=n}h=c,g=s};s!==f;)d()}var ke=function(){function r(e,t,n,i){o(this,r),this.point=e,"circle"===(this.type=t)&&(this.arcNode=n,this.centerPoint=i)}return s(r,null,[{key:"comparator",value:function(e,t){return b(e.point,t.point)}}]),r}(),Ee=function e(t,n){o(this,e),this.site=t,this.face=n,this.prevArcNode=null,this.nextArcNode=null},Ce=function(){function n(e,t){o(this,n),this.halfEdge=e,this.breakPoint=t}return s(n,[{key:"update",value:function(e,t,n){var i=2*(e.x-n),r=1/i,o=-2*e.y/i,a=(Math.pow(e.x,2)+Math.pow(e.y,2)-Math.pow(n,2))/i,s=r-1/(i=2*(t.x-n)),h=o- -2*t.y/i,c=a-(Math.pow(t.x,2)+Math.pow(t.y,2)-Math.pow(n,2))/i,u=Math.pow(h,2)-4*s*c,l=(-h+Math.sqrt(u))/(2*s),f=(-h-Math.sqrt(u))/(2*s),g=e.x>t.x?Math.max(l,f):Math.min(l,f),d=r*Math.pow(g,2)+o*g+a;this.breakPoint=new Y(d,g)}}]),n}();function Te(e,t){if(t instanceof Ce)return k(e.breakPoint,t.breakPoint);if(t instanceof Ee)return 0;throw TypeError("statusComparator argument is BreakPoint or Arc")}function _e(e,i){e.traverseCallback(function(e){if(!(e.value instanceof Ee)){var t=e.left.findMax(),n=e.right.findMin();if(!t||!n)throw Error("Status tree struct mistake, can not found breack node linked arc node:");e.value.update(t.value.site,n.value.site,i.point.x)}})}function Ve(e,t,n,i,r){var o,a,s,h,c,u,l=t.value.site;V(e,l,n)&&(o=B.bisect(l,e),a=B.bisect(l,n),h=(s=o.intersect(a)).distanceTo(l),(c=new Y(s.x+h,s.y)).x>=r&&(u=new ke(c,"circle",t,s),t.value.circleEvent=u,i.insert(u)))}function Pe(e,t,n,i){e.prev=n,(e.next=t).prev=e,(t.next=n).prev=t,n.next=e;var r=new U(e);return r.containVertice=i.filter(function(e){return O.apply(X,p(r.getVertices()).concat([e.coord]))}),r.containVertice.forEach(function(e){e.containedTri=r}),r}function Ie(e,t,n){var i,r,o,a,s,h,c,u,l=t.twin;l&&(i=l.prev.origin.coord,H(e.coord,t.origin.coord,t.end.coord,i)&&(r=t.prev,o=t.next,a=l.prev,s=l.next,(r.next=s).prev=r,(s.next=t).prev=s,((t.next=r).prev=t).origin=a.origin,(a.next=o).prev=a,(o.next=l).prev=o,((l.next=a).prev=l).origin=r.origin,h=t.incidentFace,c=l.incidentFace,o.incidentFace=c,(s.incidentFace=h).outerComponent=t,c.outerComponent=l,u=h.containVertice.concat(c.containVertice),h.containVertice=u.filter(function(e){return P(t.origin.coord,t.end.coord,e.coord)}),h.containVertice.forEach(function(e){e.containedTri=h}),c.containVertice=u.filter(function(e){return P(l.origin.coord,l.end.coord,e.coord)}),c.containVertice.forEach(function(e){e.containedTri=c}),Array.isArray(n)&&n[n.length-1].filpEdges.push(new q(t.origin.coord,t.end.coord)),Ie(e,t.prev,n),Ie(e,l.next,n)))}var Ae=function(){function i(e){o(this,i);var t=e.sort(function(e,t){return e.x-t.x}).slice(),n=e.sort(function(e,t){return e.y-t.y}).slice();this.root=this.buildKDTree(t,n,0)}return s(i,[{key:"buildKDTree",value:function(e,t,n){return 0===e.length&&0===t.length?null:1===e.length&&1===t.length?new te(e[0]):(n%2==0?(o=Math.floor(e.length/2),r=e[o].x,(i=new te({splitX:r})).left=this.buildKDTree(e.slice(0,o),t.filter(function(e){return e.x<r}),n+1),i.right=this.buildKDTree(e.slice(o+1),t.filter(function(e){return e.x>r}),n+1)):(o=Math.floor(t.length/2),r=t[o].y,(i=new te({splitY:r})).left=this.buildKDTree(e.filter(function(e){return e.y<r}),t.slice(0,o),n+1),i.right=this.buildKDTree(e.filter(function(e){return e.y>r}),t.slice(o+1),n+1)),i);var i,r,o}},{key:"search",value:function(e,t,n,i){var r=1<arguments.length&&void 0!==t?t:this.root,o=2<arguments.length&&void 0!==n?n:[],a=3<arguments.length&&void 0!==i?i:{};if(r.left||r.right){var s,h,c=r.value,u=c.splitX,l=c.splitY;if(void 0!==u)s=v(v({},a),{},{maxX:u}),h=v(v({},a),{},{minX:u});else{if(void 0===l)throw Error("KDTree inner node must has split line");s=v(v({},a),{},{maxY:l}),h=v(v({},a),{},{minY:l})}this.insideRegion(s,e)?o.push.apply(o,p(r.left.getLeafNodes())):this.intersectRegion(s,e)&&this.search(e,r.left,o,s),this.insideRegion(h,e)?o.push.apply(o,p(r.right.getLeafNodes())):this.intersectRegion(h,e)&&this.search(e,r.right,o,h)}else{var f=r.value,g=f.x,d=f.y;this.insideRegion({minX:g,maxX:g,minY:d,maxY:d},e)&&o.push(r.value)}return o}},{key:"insideRegion",value:function(e,t){return void 0!==e.minX&&void 0!==e.maxX&&void 0!==e.minY&&void 0!==e.maxY&&(e.minX>=t.minX&&e.maxX<=t.maxX&&e.minY>=t.minY&&e.maxY<=t.maxY)}},{key:"intersectRegion",value:function(e,t){return void 0!==e.minX&&e.minX>=t.minX&&e.minX<=t.maxX||(void 0!==e.maxX&&e.maxX>=t.minX&&e.maxX<=t.maxX||(void 0!==e.minY&&e.minY>=t.minY&&e.minY<=t.maxY||void 0!==e.maxY&&e.maxY>=t.minY&&e.maxY<=t.maxY))}}]),i}(),Oe=function(){n(r,Ae);c(r);function r(e){var t;o(this,r);var n=e.sort(function(e,t){return e.x-t.x}).slice(),i=e.sort(function(e,t){return e.y-t.y}).slice();return t.root=t.buildRangeTree(n,i),h(t)}return s(r,[{key:"buildRangeTree",value:function(e,t){if(1===e.length)return new te(e[0]);var n=this.buildAssocTree(t),i=Math.floor(e.length/2),r=e[i],o=new te({splitX:r,assoc:n});o.left=this.buildRangeTree(e.slice(0,i),t.filter(function(e){return e.x<r})),o.right=this.buildRangeTree(e.slice(i+1),t.filter(function(e){return e.x>r}))}},{key:"buildAssocTree",value:function(e){var t=new ie(function(e,t){return e.splitY-t.splitY});return t.node=this.convertBST(e),t}},{key:"convertBST",value:function(e,t,n){var i=1<arguments.length&&void 0!==t?t:0,r=2<arguments.length&&void 0!==n?n:e.length;if(r<i)return null;var o=Math.floor(i+r),a=new ne({splitY:e[o].y,point:e[o]});return a.left=this.convertBST(e,i,o-1),a.right=this.convertBST(e,o+1,r),a}},{key:"search",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:this.root,i=[],r=e.minX,o=e.maxX,a=e.minY,s=e.maxY,h=this.findSplitNode(r,o);if(h.left||h.right){for(var c=h.left;c.left||c.right;)c=c.value.splitX>=r?(i.push.apply(i,p(c.right.value.assoc.rangeQuery(a,s))),c.left):c.right;var u=c.leftValue;this.insideRegion({minX:u.x,maxX:u.x,minY:u.y,maxY:u.y},e)&&i.push(u);for(var l=h.right;l.left||l.right;)l=l.value.splitX<=o?(i.push.apply(i,p(l.left.value.assoc.rangeQuery(a,s))),l.right):l.left;var f=l.rightValue;this.insideRegion({minX:f.x,maxX:f.x,minY:f.y,maxY:f.y},e)&&i.push(f)}else{var g=n.value,d=g.x,v=g.y;this.insideRegion({minX:d,maxX:d,minY:v,maxY:v},e)&&i.push(n.value)}return i}},{key:"findSplitNode",value:function(e,t,n){for(var i=2<arguments.length&&void 0!==n?n:this.root;(i.left||i.right)&&(i.value.splitX<e||i.value.splitX>t);)i=i.value.splitX>=e?i.left:i.right;return i}}]),r}();e.Animation=f,e.CanvasRender=K,e.DCEL=Q,e.Geometry=J,e.KDTree=Ae,e.RangeTree=Oe,e.clipVoronoi=be,e.convexIntersect=function(e,t,n){for(var i,r,o,a,s,h,c,u,l=[],f=new Y(0,0),g=e.vertices.slice(0,-1),d=t.vertices.slice(0,-1),v=g.length,p=d.length,y=null,x=0,w=0,m=0,b=0;m<2*v&&b<2*p;){if(r=g[x],a=d[w],i=g[(x+v-1)%v],o=d[(w+p-1)%p],s=E(f,new Y(r.x-i.x,r.y-i.y),new Y(a.x-o.x,a.y-o.y)),h=E(o,a,r),c=E(i,r,a),null!==(u=new q(i,r).intersect(new q(o,a)))){if(0<l.length&&u.equal(l[0])){l.push(u);break}l.push(u),0<h?y="p":0<c&&(y="q")}if(0===s&&h<0&&c<0)return null;s===c===h===0?"p"===y?(w=(w+1)%p,b+=1):(x=(x+1)%v,m+=1):0<=s&&0<c||s<0&&h<=0?("p"===y&&l.push(r),x=(x+1)%v,m+=1):(0<=s&&c<=0||s<0&&0<h)&&("q"===y&&l.push(a),w=(w+1)%p,b+=1),Array.isArray(n)&&n.push({currentEdges:[new q(i,r),new q(o,a)],intersectPolygon:new z(l)})}return l.length<=2?null:new z(l)},e.earTriangulate=function(e){for(var t,n,i,r,o=e.vertices.slice(0,-1),a=[],s=0;3<o.length;)t=s-1==-1?o.length-1:s-1,n=s+1===o.length?0:s+1,i=t-1==-1?o.length-1:t-1,r=n+1===o.length?0:n+1,s=M(o[i],o[t],o[s],o[n])&&M(o[s],o[n],o[r],o[t])&&F(o,o[t],o[n])?(a.push([o[t],o[s],o[n]]),o.splice(s,1),s===o.length?0:s):n;return 3===o.length&&a.push(o),a},e.grahamScanCH=function(e,t){var n,i=[],r=N(e);for(i.push(r.shift()),i.push(r.shift());0<r.length;)P(i[(n=i.length)-2],i[n-1],r[0])?i.push(r.shift()):i.pop(),t&&Array.isArray(t)&&t.push({vertice:r[0],chVertices:i.map(function(e){return new Y(e.x,e.y)})});return i},e.halfplanesVD=function(i,e){for(var t,r,o,a,s,h,c,u=[],l=e.minX,f=e.maxX,g=e.minY,d=e.maxY,n=function(n){(t=i.slice()).splice(n,1),o=[new Y(2*f-i[n].x,i[n].y),new Y(i[n].x,2*d-i[n].y),new Y(2*l-i[n].x,i[n].y),new Y(i[n].x,2*g-i[n].y)],t.push.apply(t,p(o)),r=t.filter(function(e){return e.x<=i[n].x}),a=t.filter(function(e){return e.x>i[n].x}),r.sort(function(e,t){return E(i[n],t,e)}),a.sort(function(e,t){return E(i[n],t,e)}),t=r.concat(a);for(var e=0;e<t.length;e++)c=e===t.length-1?0:e+1,C(i[n],t[e],t[c])&&!A(t[e],t[c],i[n])&&(i[n].distanceTo(t[e])<=i[n].distanceTo(t[c])?t.splice(c,1):t.splice(e,1),--e);s=t.map(function(e){return B.bisect(e,i[n])}),h=function(e){if(e.length<2)return{lines:e.slice(),points:[]};var t,n=e.slice(),i=[];i.push(n[0].intersect(n[1]));for(var r,o,a=n.length-2;0<a;a--){for(;0<=i.length&&(t=n[i.length].intersect(n[i.length+1]),1<i.length?V(i[i.length-2],i[i.length-1],t):1===i.length&&n[0].right(t));)n.splice(i.length,1),i.pop();i.push(t)}for(;1<i.length;){if(t=n[n.length-1].intersect(n[0]),r=V(i[i.length-2],i[i.length-1],t),o=V(t,i[0],i[1]),!r&&!o){i.push(t);break}r&&(n.pop(),i.pop()),o&&(n.shift(),i.shift())}return{lines:n,points:i}}(s),u.push(h)},v=0;v<i.length;v++)n(v);return u},e.incremental3DCH=function(e,t){if(e&&!(e.length<4)){var n,i,r=new Q;!function(e,t){var n=I(e,4),i=n[0],r=n[1],o=L(i,r,s=n[2],h=n[3]);if(o<0)var a=[h,s],s=a[0],h=a[1];else if(0===o)throw Error("Tetrahedron vertices on the same plane");var c=new Z(i),u=new Z(r),l=new Z(s),f=new Z(h),g=new W(c),d=new W(u),v=new W(u),p=new W(l),y=new W(l),x=new W(c),w=new W(c),m=new W(f),b=new W(u),k=new W(f),E=new W(l),C=new W(f);c.incidentEdge=g,u.incidentEdge=v,l.incidentEdge=y,f.incidentEdge=m,(g.twin=d).twin=g,(v.twin=p).twin=v,(y.twin=x).twin=y,(w.twin=m).twin=w,(b.twin=k).twin=b,(E.twin=C).twin=E;var T=G(g,v,y),_=G(d,w,k),V=G(p,b,C),P=G(x,E,m);t.insertVertex(c,u,l,f),t.insertHalfEdge(g,d,v,p,y,x,w,m,b,k,E,C),t.insertFace(T,_,V,P)}(e.slice(0,4),r);for(var o,a=4;a<e.length;a++){n=!1;for(var s=0;s<r.faces.length;s++)i=r.faces[s].getVertices(),L.apply(X,p(i).concat([e[a]]))<0&&(n=r.faces[s].delete=!0);Array.isArray(t)&&t.push({point:e[a],triangles:r.faces.map(function(e){return new z(e.getVertices())}),deleteTriangles:r.faces.filter(function(e){return e.delete}).map(function(e){return new z(e.getVertices())})}),n&&(r.faces.forEach(function(e){e.delete&&e.getEdges().forEach(function(e){e.delete=!0,e.origin.delete=!0})}),function(e,t){var n=t.halfEdges.find(function(e){return e.delete&&!e.twin.delete}),i=new Z(e);t.insertVertex(i);var r,o,a,s=new W(n.origin),h=s,c=n;do{for(delete c.delete,delete c.origin.delete,a=c.next;a.twin.delete;)a=a.twin.next;c.origin.incidentEdge=c,((r=new W(i)).twin=h).twin=r,o=G(c,h=new W(c.end),r),t.insertFace(o),t.insertHalfEdge(r,h),c=a}while(c!==n);i.incidentEdge=r,h.twin=s.twin,s.twin.twin=h}(e[a],r),(o=r).vertices=o.vertices.filter(function(e){return!e.delete}),o.halfEdges=o.halfEdges.filter(function(e){return!e.delete}),o.faces=o.faces.filter(function(e){return!e.delete}))}return r}},e.incrementalCH=function(e,t){if(!(Array.isArray(e)&&t instanceof Y))throw new TypeError("Paramters Type Error");if(e.length<2)e.push(t);else if(2===e.length)e.push(t),P.apply(X,p(e))||e.reverse();else{var n=[];e.unshift(e[e.length-1]),e.push(e[1]);for(var i=1;i<e.length-1;i++)P(e[i],e[i+1],t)?n.push(e[i]):P(e[i-1],e[i],t)&&(n.push(e[i]),n.push(t));e.splice.apply(e,[0,e.length].concat(n))}return e},e.incrementalDT=function(e,p){var t=e.map(function(e){return new Z(e)}),y=new Q;return function(e,t){var n=new Z(new Y(-1e8,-1e8)),i=new Z(new Y(1e8,-1e8)),r=new Z(new Y(0,1e8)),o=new W(n);n.incidentEdge=o;var a=new W(i);i.incidentEdge=a;var s=new W(r);r.incidentEdge=s,o.prev=s,(o.next=a).prev=o,(a.next=s).prev=a,s.next=o;var h=new U(o);(h.containVertice=e).forEach(function(e){e.containedTri=h}),t.insertVertex(n,i,r),t.insertHalfEdge(o,a,s),t.insertFace(h)}(t,y),t.forEach(function(t){var e=t.containedTri,n=I(e.getEdges(),3),i=n[0],r=n[1],o=n[2],a=new W(i.origin),s=new W(t),h=new W(r.origin),c=new W(t),u=new W(o.origin),l=new W(t);(a.twin=c).twin=a,(h.twin=l).twin=h,(u.twin=s).twin=u,Array.isArray(p)&&p.push({point:t.coord,triangles:y.faces.map(function(e){return new Polygon(e.getVertices())}),splitEdges:[a,h,u].map(function(e){return new q(e.origin.coord,e.end.coord)}),filpEdges:[]});var f=e.containVertice.filter(function(e){return e!==t}),g=Pe(i,h,c,f),d=Pe(r,u,l,f),v=Pe(o,a,s,f);y.insertFace(g,d,v),y.removeFace(e),Ie(t,i,p),Ie(t,r,p),Ie(t,o,p)}),y},e.incrementalVD=function(e,t){var n,i,r,o,a,s,h,c,u,l,f,g,d;0===t.faces.length&&ve.length<2?ve.push(e):0===t.faces.length&&2===ve.length?(P(r=ve[0],i=ve[1],e)&&(i=(n=[r,i])[0],r=n[1]),o=B.bisect(r,e),a=B.bisect(e,i),s=B.bisect(i,r),h=new Z(o.intersect(a)),t.insertVertex(h),(c=new W(h)).direction=o.direction,h.incidentEdge=c,(u=new W(de)).direction=o.direction.copy().rotateZ(Math.PI),(c.twin=u).twin=c,(l=new W(de)).direction=a.direction.copy().rotateZ(Math.PI),(f=new W(h)).direction=a.direction,(l.twin=f).twin=l,(g=new W(h)).direction=s.direction,(d=new W(de)).direction=s.direction.copy().rotateZ(Math.PI),(g.twin=d).twin=g,we(c,l,e,t),we(f,d,i,t),we(g,u,r,t),ve.length=0):xe(e,function(e,t,n){for(var i,r,o,a,s=2<arguments.length&&void 0!==n?n:1e4,h=0,c=t,u=e.distanceTo(c.site);c;){o=Number.POSITIVE_INFINITY,a=c.getAdjacentFaces();for(var l=0;l<a.length;l++)(i=e.distanceTo(a[l].site))<o&&(o=i,r=a[l]);if(u<=o)return c;if(u=o,c=r,s<(h+=1))throw Error("Traverse out of tolerance")}throw Error("Not found nearest neighbour face(site)")}(e,t.faces[t.faces.length-1]),t)},e.segmentsIntersect=function(e,t){var n,i,r,o,a,s,h,c,u,l,f,g,d,v,p,y,x,w,m=(s=[],e.forEach(function(e){r=new ae(e),a=e.begin.x<e.end.x||e.begin.x===e.end.x&&e.begin.y<e.end.y?(o=e.begin,e.end):(o=e.end,e.begin),s.push(new oe(o,"leftEnd",[r])),s.push(new oe(a,"rightEnd",[r]))}),new ee(s,0,oe.comparator)),b=new ie(ae.comparator);re.length=0;try{for(;0<m.length;){"leftEnd"===(g=m.pop()).type?(he(b,g),h=I(g.segments,1)[0],b.insert(h),n=b.getLeft(h),i=b.getRight(h),n&&se(m,h,n.value),i&&se(m,h,i.value)):"rightEnd"===g.type?(he(b,g),h=I(g.segments,1)[0],n=b.getLeft(h),i=b.getRight(h),n&&i&&se(m,n.value,i.value),b.remove(h)):(l=u=void 0,ae.comparator(g.segments[0],g.segments[1])<0?(u=(c=I(g.segments,2))[0],l=c[1]):(l=(f=I(g.segments,2))[0],u=f[1]),n=b.getLeft(u),(i=b.getRight(l))&&se(m,u,i.value),n&&se(m,l,n.value),v=u,p=l,x=y=void 0,y=(d=b).find(v),x=d.find(p),w=y.value,y.value=x.value,x.value=w,he(b,g)),t&&Array.isArray(t)&&t.push({event:ce(g),statusTree:ce(b.traverse()),intersections:ce(re)})}}catch(e){console.log("Erro"),console.log(e)}return re},e.sweepVD=function(e,t){for(var n,i,r,o,a,s,h,c,u,l,f,g,d,v,p,y,x,w,m,b,k,E,C,T=(n=e.map(function(e){return new ke(e,"site")}),new ee(n,0,ke.comparator)),_=new ie(Te),V=new Q;0<T.length;)"site"===(i=T.pop()).type?(_e(_,i),r=i,o=T,a=_,s=V,C=E=k=x=y=p=v=d=g=u=c=h=void 0,(C=new U).site=r.point,s.insertFace(C),a.isEmpty()?a.insert(new Ee(r.point,C)):((c=(h=a.find(new Ce(null,r.point))).value).circleEvent&&(c.circleEvent.type="falseAlarm"),u=B.bisect(c.site,r.point),l=(r.point.y-u.origin.y)/u.direction.y,f=u.getPoint(l),g=new W(new Z(f)),d=new W(new Z(f)),((g.twin=d).twin=g).incidentFace=c.face,c.face.outerComponent||(c.face.outerComponent=g),(d.incidentFace=C).outerComponent=d,s.insertHalfEdge(g),s.insertHalfEdge(d),v=new Ee(c.site,c.face),p=new Ee(c.site,c.face),y=new Ee(r.point,C),x=new ne(new Ce(d,f),Te),w=new ne(v,Te),m=new ne(p,Te),b=new ne(y,Te),h.setValue(new Ce(g,f)),h.setLeft(w),h.setRight(x),x.setLeft(b),x.setRight(m),v.prevArcNode=c.prevArcNode,v.nextArcNode=b,y.prevArcNode=w,y.nextArcNode=m,p.prevArcNode=b,p.nextArcNode=c.nextArcNode,k=c.prevArcNode,E=c.nextArcNode,k&&(k.value.nextArcNode=w,Ve(k.value.site,w,r.point,o,r.point.x)),E&&(E.value.prevArcNode=m,Ve(r.point,m,E.value.site,o,r.point.x)))):"circle"===i.type&&function(e,t,n,i){var r=e.arcNode,o=e.centerPoint,a=r.value,s=a.prevArcNode,h=a.nextArcNode;s.value.circleEvent&&(s.value.circleEvent.type="falseAlarm"),h.value.circleEvent&&(h.value.circleEvent.type="falseAlarm");var c=s.value.prevArcNode,u=h.value.nextArcNode;c&&Ve(c.value.site,s,h.value.site,t,e.point.x),u&&Ve(s.value.site,h,u.value.site,t,e.point.x),(s.value.nextArcNode=h).value.prevArcNode=s;var l=new Z(o),f=new W(l),l=new Z(o),g=new W(l);l.incidentEdge=g,((f.twin=g).twin=f).incidentFace=s.value.face,g.incidentFace=h.value.face,i.insertHalfEdge(f),i.insertHalfEdge(g),i.insertVertex(l);var d=n.findLCA(s.value,a),v=n.findLCA(a,h.value);if(!d||!v)throw Error("Status tree struct mistake, can not found two arc node linked breack node:");var p=d.value.halfEdge,y=v.value.halfEdge;p.origin=l,y.origin=l,(((p.prev=f).next=p).twin.next=y).prev=p.twin,(y.twin.next=g).prev=y.twin;var x=r.parent,w=r.sibling();if(x===v)d.value.halfEdge=f;else{if(x!==d)throw Error("Update break node halfEdge error");v.value.halfEdge=f}if(x.isRight())x.parent.setRight(w);else{if(!x.isLeft())throw Error("circle event linked node struct error");x.parent.setLeft(w)}}(i,T,_,V);return"site"!==i.type&&_e(_,i),_.traverseCallback(function(e){var t,n,i,r;e.value instanceof Ce&&(n=(t=e.value).breakPoint,r=(i=t.halfEdge).end.coord,i.origin=new Z,i.twin.direction=new D(n.x-r.x,n.y-r.y).normalize())}),t&&be(V,t),V},e.trapezoidTriangulate=function(e,t){var n=[],i=ge(e);return Array.isArray(t)&&t.push.apply(t,p(i.slice())),i.forEach(function(e){n.push.apply(n,p(function(e){for(var t,n,i,r=e.length,o=[],a=0;a<r;a++)t=0===a?r-1:a-1,n=a===r-1?0:a+1,i=e[a].x>e[t].x&&e[a].x<e[n].x?"lower":"upper",o.push({vertex:e[a],type:i});o.sort(function(e,t){return e.vertex.x-t.vertex.x});var s,h,c,u=[],l=o.slice(0,2);for(a=2;a<r-1;a++)if((s=l.pop()).type===o[a].type){for(;0<l.length;){if(h=l.pop(),!("upper"===s.type?_(o[a].vertex,s.vertex,h.vertex):_(h.vertex,s.vertex,o[a].vertex))){l.push(h,s);break}if(c="upper"===s.type?[o[a].vertex,s.vertex,h.vertex]:[o[a].vertex,h.vertex,s.vertex],u.push(c),s=h,0===l.length){l.push(h);break}}l.push(o[a])}else{for(;0<l.length;)c="upper"===(h=l.pop()).type?[o[a].vertex,s.vertex,h.vertex]:[o[a].vertex,h.vertex,s.vertex],u.push(c),s=h;l.push(o[a-1],o[a])}for(a=0;a<l.length-1;a++)c="uppper"===l[a].type?[o[r-1].vertex,l[a+1].vertex,l[a].vertex]:[o[r-1].vertex,l[a].vertex,l[a+1].vertex],u.push(c);return u}(e)))}),n},e.upperLowerCH=function(e){for(var t,n,i=[],r=[],o=e.slice().sort(function(e,t){return e.x-t.x||e.x===t.x&&e.y-t.y}),a=o.length-1;0<=a;)(t=i.length)<2||P(i[t-2],i[t-1],o[a])?(i.push(o[a]),--a):i.pop();for(a=0;a<o.length;)(n=r.length)<2||P(r[n-2],r[n-1],o[a])?(r.push(o[a]),a+=1):r.pop();return r.shift(),r.pop(),i.concat(r)},Object.defineProperty(e,"__esModule",{value:!0})});
