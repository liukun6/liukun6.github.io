!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).CG={})}(this,function(t){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function e(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function a(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,n,i;e=r,i=o[n=t],n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(o,t))})}return r}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=r(n);return s(this,i?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var s,h=t[Symbol.iterator]();!(i=(s=h.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==h.return||h.return()}finally{if(r)throw o}}return n}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var y=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,n),this.callback=t,this.options=e,this._playing=!1,this._step=-1}return h(n,[{key:"_setTimeout",value:function(){var t=this.options.frameDuration;this._requestId=t?window.setTimeout(this._anim.bind(this),t):window.requestAnimationFrame(this._anim.bind(this))}},{key:"_clearTimeout",value:function(){this.options.frameDuration?window.clearTimeout(this._requestId):window.cancelAnimationFrame(this._requestId)}},{key:"_anim",value:function(){var t=this.options,e=t.frameCount,n=t.recycle;if(e&&this._step>=e-1?this._step=0:this._step+=1,this.callback(this._step),!1===n&&e&&this._step===e-1)return this._playing=!1,void(this._step=-1);this._playing&&this._setTimeout()}},{key:"start",value:function(){this._playing||(this._setTimeout(),this._playing=!0)}},{key:"stop",value:function(){this._clearTimeout(),this._playing=!1,this._step=-1}},{key:"pause",value:function(){this._playing&&(this._clearTimeout(),this._playing=!1)}},{key:"reset",value:function(){this._clearTimeout(),this._playing=!1,this._step=-1,this.callback(this._step)}},{key:"setStep",value:function(t){var e=this.options.frameCount,n=Number.parseInt(t,10);!this._playing&&e&&-1<n&&n<e&&(this._step=n,this.callback(this._step))}},{key:"next",value:function(){var t=this.options.frameCount;this._playing||(t&&this._step>=t-1?this._step=0:this._step+=1,this.callback(this._step))}},{key:"prev",value:function(){var t=this.options.frameCount;this._playing||(this._step<=0?this._step=t?t-1:0:--this._step,this.callback(this._step))}}]),n}(),g=3,v="#ca562c",p=2,d="#3969AC",x={width:2,strokeColor:"#008080",fillColor:"#b4c8a8"},b=1e-10;function m(t,e){return t.equal(e)?0:t.x<e.x||t.x===e.x&&t.y<e.y?-1:1}function C(t,e,n){return t.x*e.y-t.y*e.x+e.x*n.y-e.y*n.x+n.x*t.y-n.y*t.x}function w(t,e,n){return 0<C(t,e,n)}function O(t,e,n){return 0<=C(t,e,n)}function T(t,e,n){return C(t,e,n)<0}function _(t,e,n){var i=C(t,e,n);if(0<i)return!0;if(i<0)return!1;if(t.distanceTo(e)<t.distanceTo(n))return!0;if(t.distanceTo(e)>t.distanceTo(n))return!1;throw new Error("toLeft: Input same point")}function P(t,e,n){return 0===C(t,e,n)&&(t.x!==e.x?t.x<=n.x&&n.x<=e.x||e.x<=n.x&&n.x<=t.x:t.y<=n.y&&n.y<=e.y||e.y<=n.y&&n.y<=t.y)}function S(t,e,n,i){return!(t.equal(n)||t.equal(i)||e.equal(n)||e.equal(i))&&(w(t,e,n)!==w(t,e,i)&&w(n,i,t)!==w(n,i,e))}function I(t){for(var e=0,n=1;n<t.length;n++)(t[n].y<t[e].y||t[n].y===t[e].y&&t[n].x<t[e])&&(e=n);return e}function E(t){var e=t.slice(),n=I(e),i=e[n];return e.splice(n,1),e.sort(function(t,e){return C(i,e,t)}),e.unshift(i),e}var M=Object.freeze({__proto__:null,PRECISION:b,pointComparator:m,pointComparatorY:function(t,e){return t.equal(e)?0:t.y<e.y||t.y===e.y&&t.x<e.x?-1:1},area2:C,areaSign:function(t,e,n){var i=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y);return i<-.5?-1:.5<i?1:0},collinear:function(t,e,n){return Math.abs(C(t,e,n))<b},left:w,leftOn:O,right:T,toLeft:_,between:P,inTriangle:function(t,e,n,i){var r=_(e,n,i);return _(t,e,i)===r&&r===_(n,t,i)},intersectProp:S,diagonalie:function(t,e,n){for(var i=t.length,r=0;r<i-1;r++)if(S(t[r],t[r+1],e,n))return!1;return!(!t[i-1].equal(t[0])&&S(t[i-1],t[0],e,n))},inCone:function(t,e,n,i){return O(e,n,t)?w(e,i,t)&&w(i,e,n):!(O(e,i,n)&&O(i,e,t))},LTL:I,leftSort:E,inCircumcircle:function(t,e,n,i){var r=Math.pow(i.x,2)+Math.pow(i.y,2),o=Math.pow(t.x,2)+Math.pow(t.y,2)-r,s=Math.pow(e.x,2)+Math.pow(e.y,2)-r,h=Math.pow(n.x,2)+Math.pow(n.y,2)-r;return 0<(t.x-i.x)*(e.y-i.y)*h+(e.x-i.x)*(n.y-i.y)*o+(n.x-i.x)*(t.y-i.y)*s-(t.x-i.x)*(n.y-i.y)*s-(e.x-i.x)*(t.y-i.y)*h-(n.x-i.x)*(e.y-i.y)*o},volumeSign:function(t,e,n,i){var r=t.x-i.x,o=t.y-i.y,s=t.z-i.z,h=e.x-i.x,a=e.y-i.y,u=e.z-i.z,l=n.x-i.x,c=n.y-i.y,f=n.z-i.z,y=r*(a*f-u*c)-o*(h*f-u*l)+s*(h*c-a*l);return y<-.5?-1:.5<y?1:0}}),V=function(){function i(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;o(this,i),this.x=t,this.y=e,this.z=n}return h(i,[{key:"distanceTo",value:function(t){if(!(t instanceof i))throw new TypeError("parameter is not Point");return Math.sqrt(Math.pow(Math.abs(this.x-t.x),2)+Math.pow(Math.abs(this.y-t.y),2)+Math.pow(Math.abs(this.z-t.z),2))}},{key:"equal",value:function(t){if(!(t instanceof i))throw new TypeError("parameter is not Point");return Math.abs(this.x-t.x)<b&&Math.abs(this.y-t.y)<b&&Math.abs(this.z-t.z)<b}}]),i}(),q=function(){function s(t,e){if(o(this,s),t instanceof V&&e instanceof V)return this.begin=t,void(this.end=e);try{this.begin=new V(t.x,t.y),this.end=new V(e.x,e.y)}catch(t){throw new TypeError("Segment needs begin & end point")}}return h(s,[{key:"parallelInt",value:function(t){return 0!==C(this.begin,this.end,t.begin)?null:P(this.begin,this.end,t.begin)?t.begin:P(this.begin,this.end,t.end)?t.end:P(t.begin,t.end,this.begin)?this.begin:P(t.begin,t.end,this.end)?this.end:null}},{key:"intersect",value:function(t){if(!(t instanceof s))throw new TypeError("Not Segment");var e=this.begin.x*(t.end.y-t.begin.y)+this.end.x*(t.begin.y-t.end.y)+t.end.x*(this.end.y-this.begin.y)+t.begin.x*(this.begin.y-this.end.y);if(0==e)return this.parallelInt(t);var n=(this.begin.x*(t.end.y-t.begin.y)+t.begin.x*(this.begin.y-t.end.y)+t.end.x*(t.begin.y-this.begin.y))/e,i=-(this.begin.x*(t.begin.y-this.end.y)+this.end.x*(this.begin.y-t.begin.y)+t.begin.x*(this.end.y-this.begin.y))/e;if(n<-b||1+b<n||i<-b||1+b<i)return null;var r=this.begin.x+n*(this.end.x-this.begin.x),o=this.begin.y+n*(this.end.y-this.begin.y);return new V(r,o)}},{key:"intersectProp",value:function(t){if(!(t instanceof s))throw new TypeError("Not Segment");return _(this.begin,this.end,t.begin)!==_(this.begin,this.end,t.end)&&_(t.begin,t.end,this.begin)!==_(t.begin,t.end,this.end)}}]),s}(),z=function(){function e(t){o(this,e),this.vertices=t.slice(),t[0]&&!t[0].equal(t[t.length-1])&&this.vertices.push(t[0])}return h(e,[{key:"area",value:function(){for(var t=this.vertices.length,e=0,n=0;n<t-1;n++)e+=(this.vertices[n].x+this.vertices[n+1].x)*(this.vertices[n+1].y-this.vertices[n].y);return e/2}}]),e}(),j=function(){function r(t,e,n,i){o(this,r),this.leftBottom=new V(t,e),this.rightTop=new V(n,i)}return h(r,[{key:"Intersect",value:function(t){return!(this.leftBottom.x>t.rightTop.x||this.rightTop.x<t.leftBottom.x)&&!(this.leftBottom.y>t.rightTop.y||this.rightTop.y<t.leftBottom.y)}}]),r}(),A=function(){function i(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;o(this,i),this.x=t,this.y=e,this.z=n}return h(i,[{key:"normalize",value:function(){var t=this.length;return new i(this.x/t,this.y/t,this.z/t)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"rotateZ",value:function(t){var e=Math.cos(t),n=Math.sin(t),i=this.x,r=this.y;return this.x=i*e-r*n,this.y=i*n+r*e,this}},{key:"copy",value:function(){return new i(this.x,this.y,this.z)}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}],[{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"cross",value:function(t,e){return new i(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}},{key:"cos",value:function(t,e){return this.dot(t.normalize(),e.normalize())}},{key:"projection",value:function(t,e){return t.copy().scale(e.length*this.cos(t,e))}}]),i}(),L=function(){function n(t,e){o(this,n);try{this.origin=new V(t.x,t.y),this.direction=new A(e.x,e.y)}catch(t){throw new TypeError("Line need origin and direction:",t)}}return h(n,[{key:"getPoint",value:function(t){return new V(this.origin.x+t*this.direction.x,this.origin.y+t*this.direction.y)}},{key:"intersect",value:function(t){var e=this.getPoint(1),n=t.getPoint(1),i=this.origin.x*(n.y-t.origin.y)+e.x*(t.origin.y-n.y)+n.x*(e.y-this.origin.y)+t.origin.x*(this.origin.y-e.y);if(0==i)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(t)));var r=(this.origin.x*(n.y-t.origin.y)+t.origin.x*(this.origin.y-n.y)+n.x*(t.origin.y-this.origin.y))/i,o=this.origin.x+r*(e.x-this.origin.x),s=this.origin.y+r*(e.y-this.origin.y);return new V(o,s)}},{key:"intersectSegProp",value:function(t){return this.right(t.begin)!==this.right(t.end)}},{key:"intersectSegment",value:function(t){var e=this.getPoint(1),n=this.origin.x*(t.end.y-t.begin.y)+e.x*(t.begin.y-t.end.y)+t.end.x*(e.y-this.origin.y)+t.begin.x*(this.origin.y-e.y);if(0==n)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(t)));var i=-(this.origin.x*(t.begin.y-e.y)+e.x*(this.origin.y-t.begin.y)+t.begin.x*(e.y-this.origin.y))/n;if(i<-b||1+b<i)throw new Error("Line not intersect segment: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(t)));var r=t.begin.x+i*(t.end.x-t.begin.x),o=t.begin.y+i*(t.end.y-t.begin.y);return new V(r,o)}},{key:"intersectRay",value:function(t){var e=this.getPoint(1),n=t.getPoint(1),i=this.origin.x*(n.y-t.origin.y)+e.x*(t.origin.y-n.y)+n.x*(e.y-this.origin.y)+t.origin.x*(this.origin.y-e.y);if(0==i)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(seg)));var r=-(this.origin.x*(t.origin.y-e.y)+e.x*(this.origin.y-t.origin.y)+t.origin.x*(e.y-this.origin.y))/i;if(r<-b)return null;var o=t.origin.x+r*(n.x-t.origin.x),s=t.origin.y+r*(n.y-t.origin.y);return new V(o,s)}},{key:"rayIntersectSegment",value:function(t){var e=this.getPoint(1),n=this.origin.x*(t.end.y-t.begin.y)+e.x*(t.begin.y-t.end.y)+t.end.x*(e.y-this.origin.y)+t.begin.x*(this.origin.y-e.y);if(0==n)throw new Error("Parallel: ".concat(JSON.stringify(this),", ").concat(JSON.stringify(t)));var i=(this.origin.x*(t.end.y-t.begin.y)+t.begin.x*(this.origin.y-t.end.y)+t.end.x*(t.begin.y-this.origin.y))/n,r=-(this.origin.x*(t.begin.y-e.y)+e.x*(this.origin.y-t.begin.y)+t.begin.x*(e.y-this.origin.y))/n;if(i<-b||r<-b||1+b<r)return null;var o=t.begin.x+r*(t.end.x-t.begin.x),s=t.begin.y+r*(t.end.y-t.begin.y);return new V(o,s)}},{key:"right",value:function(t){return T(this.origin,this.getPoint(1),t)}},{key:"left",value:function(t){return w(this.origin,this.getPoint(1),t)}}],[{key:"bisect",value:function(t,e){if(t.equal(e))throw new Error("Input equal points");return new n(new V((t.x+e.x)/2,(t.y+e.y)/2),new A(e.x-t.x,e.y-t.y).normalize().rotateZ(-Math.PI/2))}}]),n}(),R=Object.freeze({__proto__:null,Util:M,Point:V,Segment:q,Polygon:z,Rectangle:j,Line:L,Vector:A}),N=function(){function i(t){o(this,i),this.canvas=t;var e=Math.max(window.devicePixelRatio||2,2),n=this.canvas.getBoundingClientRect();this.width=n.width,this.height=n.height,this.canvas.width=n.width*e,this.canvas.height=n.height*e,this.ctx=t.getContext("2d"),this.ctx.scale(e,e),this.ctx.lineJoin="round"}return h(i,[{key:"clearCanvas",value:function(){var t=this.ctx.canvas,e=t.width,n=t.height;this.ctx.clearRect(0,0,e,n)}},{key:"drawPoint",value:function(t,e,n){var i,r=1<arguments.length&&void 0!==e?e:g,o=2<arguments.length&&void 0!==n?n:v;t&&t instanceof V&&(i=this.height,this.ctx.save(),this.ctx.lineWidth=r,this.ctx.strokeStyle=o,this.ctx.beginPath(),this.ctx.arc(t.x,i-t.y,r/2,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}},{key:"drawPoints",value:function(t,e,n){var i,r=this,o=1<arguments.length&&void 0!==e?e:g,s=2<arguments.length&&void 0!==n?n:v;Array.isArray(t)&&(i=this.height,this.ctx.save(),this.ctx.lineWidth=o,this.ctx.strokeStyle=s,this.ctx.beginPath(),t.forEach(function(t){r.ctx.moveTo(t.x,i-t.y),r.ctx.arc(t.x,i-t.y,o/2,0,2*Math.PI)}),this.ctx.stroke(),this.ctx.restore())}},{key:"drawSegment",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:p,r=2<arguments.length&&void 0!==n?n:d,o=this.height;this.ctx.save(),void 0!==i&&(this.ctx.lineWidth=i),void 0!==r&&(this.ctx.strokeStyle=r),this.ctx.beginPath(),this.ctx.moveTo(t.begin.x,o-t.begin.y),this.ctx.lineTo(t.end.x,o-t.end.y),this.ctx.stroke(),this.ctx.restore()}},{key:"drawSegments",value:function(t,e,n){var i=this,r=1<arguments.length&&void 0!==e?e:p,o=2<arguments.length&&void 0!==n?n:d;this.ctx.save(),void 0!==r&&(this.ctx.lineWidth=r),void 0!==o&&(this.ctx.strokeStyle=o);var s=this.height;this.ctx.beginPath(),t.forEach(function(t){i.ctx.moveTo(t.begin.x,s-t.begin.y),i.ctx.lineTo(t.end.x,s-t.end.y)}),this.ctx.stroke(),this.ctx.restore()}},{key:"drawPolygon",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{style:{}},i=a({},x);Object.assign(i,n.style),this.ctx.save(),this.ctx.lineWidth=i.width,this.ctx.fillStyle=i.fillColor,this.ctx.strokeStyle=i.strokeColor;var r=t.vertices;if(r&&Array.isArray(r)&&!(r.length<1)){var o=this.height;this.ctx.beginPath(),this.ctx.moveTo(r[0].x,o-r[0].y);for(var s=1;s<r.length;s++)this.ctx.lineTo(r[s].x,o-r[s].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}}},{key:"drawPolygons",value:function(t,e){var n,i,r,o=this,s=1<arguments.length&&void 0!==e?e:{style:{}};t&&Array.isArray(t)&&(n=a({},x),Object.assign(n,s.style),this.ctx.save(),this.ctx.lineWidth=n.width,this.ctx.fillStyle=n.fillColor,this.ctx.strokeStyle=n.strokeColor,i=this.height,this.ctx.beginPath(),t.forEach(function(t){if((r=t.vertices?t.vertices:t)&&Array.isArray(r)&&1<r.length){o.ctx.moveTo(r[0].x,i-r[0].y);for(var e=1;e<r.length;e++)o.ctx.lineTo(r[e].x,i-r[e].y);o.ctx.closePath()}}),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore())}},{key:"drawText",value:function(t,e,n,i){var r=1<arguments.length&&void 0!==e?e:0,o=2<arguments.length&&void 0!==n?n:0,s=3<arguments.length&&void 0!==i?i:{style:{},fill:!0},h=this.height;this.ctx.save(),s.textBaseline&&(this.ctx.textBaseline=s.textBaseline),this.ctx.font=s.font,s.fill?this.ctx.fillText(t,r,h-o):this.ctx.strokeText(t,r,h-o),this.ctx.restore()}}]),i}();var J=function(){function e(t){o(this,e),this.compare=t||e.defaultCompareFunction}return h(e,[{key:"equal",value:function(t,e){return 0===this.compare(t,e)}},{key:"lessThan",value:function(t,e){return this.compare(t,e)<0}},{key:"greaterThan",value:function(t,e){return 0<this.compare(t,e)}},{key:"lessThanOrEqual",value:function(t,e){return this.lessThan(t,e)||this.equal(t,e)}},{key:"greaterThanOrEqual",value:function(t,e){return this.greaterThan(t,e)||this.equal(t,e)}},{key:"reverse",value:function(){var n=this.compare;this.compare=function(t,e){return n(e,t)}}}],[{key:"defaultCompareFunction",value:function(t,e){return t===e?0:t<e?-1:1}}]),e}(),H=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length?arguments[2]:void 0;o(this,r),this.heapType=e,this.compareFunciont=n,this.nodeValueComparator=new J(n),this.heapContainter=t.slice();for(var i=Math.floor(this.length/2);0<=i;i--)this.heapifyDown(i)}return h(r,[{key:"inHeap",value:function(t){return 0<=t&&t<this.length}},{key:"getLeftIndex",value:function(t){return 2*t+1}},{key:"getRightIndex",value:function(t){return 2*t+2}},{key:"getParentIndex",value:function(t){return Math.floor((t-1)/2)}},{key:"getLeft",value:function(t){return this.heapContainter[this.getLeftIndex(t)]}},{key:"getRight",value:function(t){return this.heapContainter[this.getRightIndex(t)]}},{key:"getParent",value:function(t){return this.heapContainter[this.getParentIndex(t)]}},{key:"insert",value:function(t){return this.heapContainter.push(t),this.heapifyUp(),this}},{key:"pop",value:function(){if(0===this.length)return null;if(1===this.length)return this.heapContainter.pop();var t=this.heapContainter[0];return this.heapContainter[0]=this.heapContainter.pop(),this.heapifyDown(),t}},{key:"heapifyUp",value:function(t){for(var e=t||this.heapContainter.length-1,n=this.getParentIndex(e);this.inHeap(n)&&!this.isCorrectOrder(this.heapContainter[n],this.heapContainter[e]);)this.swap(e,n),e=this.getParentIndex(e),n=this.getParentIndex(e)}},{key:"heapifyDown",value:function(t){for(var e=t||0,n=this.getLeftIndex(e);this.inHeap(n)&&(this.inHeap(n+1)&&this.isCorrectOrder(this.heapContainter[n+1],this.heapContainter[n])&&(n+=1),!this.isCorrectOrder(this.heapContainter[e],this.heapContainter[n]));)this.swap(e,n),e=n,n=this.getLeftIndex(e)}},{key:"isCorrectOrder",value:function(t,e){return this.heapType?this.nodeValueComparator.greaterThanOrEqual(t,e):this.nodeValueComparator.lessThanOrEqual(t,e)}},{key:"swap",value:function(t,e){var n=this.heapContainter[t];this.heapContainter[t]=this.heapContainter[e],this.heapContainter[e]=n}},{key:"toString",value:function(){return this.heapContainter.toString()}},{key:"length",get:function(){return this.heapContainter.length}}]),r}(),D=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;o(this,n),this.left=null,this.right=null,this.parent=null,this.value=t,this.compareFunction=e,this.nodeValueComparator=new J(e)}return h(n,[{key:"setValue",value:function(t){return this.value=t,this}},{key:"setLeft",value:function(t){return this.left=t,this.left&&(this.left.parent=this),this}},{key:"setRight",value:function(t){return this.right=t,this.right&&(this.right.parent=this),this}},{key:"removeChild",value:function(t){return this.left&&this.nodeValueComparator.equal(this.left.value,t.value)?!(this.left=null):!(!this.right||!this.nodeValueComparator.equal(this.right.value,t.value))&&!(this.right=null)}},{key:"replaceChild",value:function(t,e){return!(!t||!e)&&(this.left&&this.nodeValueComparator.equal(this.left,t)?(this.left=e,!0):!(!this.right||!this.nodeValueComparator.equal(this.right,t))&&(this.right=e,!0))}},{key:"traverseInOrder",value:function(t){var e=0<arguments.length&&void 0!==t?t:[];return this.left&&this.left.traverseInOrder(e),null!==this.value&&e.push(this.value),this.right&&this.right.traverseInOrder(e),e}},{key:"traverseInOrderCallback",value:function(t){this.left&&this.left.traverseInOrderCallback(t),null!==this.value&&t(this),this.right&&this.right.traverseInOrderCallback(t)}},{key:"sibling",value:function(){return this.parent?this.parent.left===this?this.parent.right:this.parent.left:null}},{key:"isRight",value:function(){return!(!this.parent||this.parent.right!==this)}},{key:"isLeft",value:function(){return!(!this.parent||this.parent.left!==this)}},{key:"getLeafNodes",value:function(t){var e=0<arguments.length&&void 0!==t?t:[];return this.left&&this.left.getLeafNodes(e),this.right&&this.right.getLeafNodes(e),this.left||this.right||!this.value||e.push(this.value),e}},{key:"leftHight",get:function(){return this.left?this.left.height:0}},{key:"rightHight",get:function(){return this.right?this.right.height:0}},{key:"height",get:function(){return Math.max(this.leftHight,this.rightHight)+1}},{key:"balanceFactor",get:function(){return this.leftHight-this.rightHight}}],[{key:"copyNode",value:function(t,e){e.setValue(t.value),e.setLeft(t.left),e.setRight(t.right)}}]),n}(),F=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(r,D);var i=u(r);function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length?arguments[1]:void 0;return o(this,r),(t=i.call(this,e)).compareFunction=n,t.nodeValueComparator=new J(n),t}return h(r,[{key:"insert",value:function(t){return null===this.value?(this.value=t,this):this.nodeValueComparator.lessThan(t,this.value)?this.left?this.left.insert(t):(e=new r(t,this.compareFunction),this.setLeft(e),e):this.nodeValueComparator.greaterThan(t,this.value)?this.right?this.right.insert(t):(e=new r(t,this.compareFunction),this.setRight(e),e):this;var e}},{key:"find",value:function(t){return this.nodeValueComparator.equal(t,this.value)?this:this.nodeValueComparator.lessThan(t,this.value)&&this.left?this.left.find(t):this.nodeValueComparator.greaterThan(t,this.value)&&this.right?this.right.find(t):null}},{key:"remove",value:function(t){var e=this.find(t);if(!e)throw new Error("Item not found in the tree");var n,i,r=e.parent;return e.left||e.right?e.left&&e.right?(n=e.right.findMin().value,this.nodeValueComparator.equal(n,e.right.value)?(e.setValue(e.right.value),e.setRight(e.right.right)):(e.setValue(n),e.right.remove(n))):(i=e.left||e.right,D.copyNode(i,e)):r?r.removeChild(e):e.setValue(null),!0}},{key:"findMin",value:function(){return this.left?this.left.findMin():this}},{key:"findMax",value:function(){return this.right?this.right.findMax():this}},{key:"getLeft",value:function(){if(this.left)return this.left.findMax();for(var t=this,e=t.parent;e;){if(e.right===t)return e;e=(t=e).parent}return null}},{key:"getRight",value:function(){if(this.right)return this.right.findMin();for(var t=this,e=t.parent;e;){if(e.left===t)return e;e=(t=e).parent}return null}}]),r}(),B=function(){function e(t){o(this,e),this.root=new F(null,t)}return h(e,[{key:"insert",value:function(t){return this.root.insert(t)}},{key:"remove",value:function(t){return this.root.remove(t)}},{key:"find",value:function(t){return this.root.find(t)}},{key:"traverseCallback",value:function(t){return this.root.traverseInOrderCallback(t)}},{key:"traverse",value:function(){return this.root.traverseInOrder()}},{key:"getLeft",value:function(t){var e=this.find(t);if(!e)throw new Error("Item not found in the tree");return e.getLeft()}},{key:"getRight",value:function(t){var e=this.find(t);if(!e)throw new Error("Item not found in the tree");return e.getRight()}},{key:"contains",value:function(t){return!!this.find(t)}},{key:"toString",value:function(){return this.root.traverseInOrder().toString()}},{key:"findLCA",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:this.root;if(null===i)return null;if(i.value===t||i.value===e)return i;var r=this.findLCA(t,e,i.left),o=this.findLCA(t,e,i.right);return r&&o?i:r||o}},{key:"isEmpty",value:function(){return null===this.root.value}},{key:"rangeQuery",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:this.root;if(null===i)return[];var r=[],o=this.findSplitNode(t,e,i);if(o.left||o.right){for(var s=o.left;s.left||s.right;)s=this.nodeValueComparator.lessThan(s.value,t)?s.right:(r.push.apply(r,l(s.right.traverseInOrder())),s.left);this.nodeValueComparator.lessThan(s.value,t)||this.nodeValueComparator.greaterThan(s.value,e)||r.push(s.value);for(var h=o.right;h.left||h.right;)this.nodeValueComparator.greaterThan(h.value,e)?h=h.left:r.push.apply(r,l(h.left.traverseInOrder()));this.nodeValueComparator.lessThan(h.value,t)||this.nodeValueComparator.greaterThan(h.value,e)||r.push(h.value)}else this.nodeValueComparator.lessThan(o.value,t)||this.nodeValueComparator.greaterThan(o.value,e)||r.push(o.value);return r}},{key:"findSplitNode",value:function(t,e,n){for(var i=2<arguments.length&&void 0!==n?n:this.root;(i.left||i.right)&&(this.nodeValueComparator.lessThan(i.value,t)||this.nodeValueComparator.greaterThan(i.value,e));)i=this.nodeValueComparator.lessThan(i.value,t)?i.right:i.left;return i}}]),e}(),W=[],U=function(){function i(t,e,n){o(this,i),this.point=t,this.type=e,this.segments=n}return h(i,null,[{key:"comparator",value:function(t,e){return m(t.point,e.point)}}]),i}(),G=function(){function e(t){o(this,e),this.segment=t,this.compareValue=m(t.begin,t.end)<0?t.begin.y:t.end.y}return h(e,[{key:"update",value:function(t){var e=new q({x:t,y:-1e5},{x:t,y:1e5});this.compareValue=this.segment.intersect(e).y}},{key:"toString",value:function(){return JSON.stringify(this)}}],[{key:"comparator",value:function(t,e){var n=t.compareValue-e.compareValue;if(Math.abs(n)>b)return n;if(t.segment===e.segment)return 0;var i,r=t.segment,o=e.segment,s=m(r.begin,r.end)<0?(i=r.end,r.begin):(i=r.begin,r.end);return _(s,i,m(o.begin,o.end)<0?o.end:o.begin)?-1:1}}]),e}();function Z(t,r,o){var e,n=r.segment,i=o.segment,s=W.find(function(t){var e=k(t.segments,2),n=e[0],i=e[1];return n===r&&i===o||n===o&&i===r});void 0!==s&&-1!==s||!n.intersectProp(i)||(e=new U(n.intersect(i),"intersect",[r,o]),t.insert(e),W.push(e))}function Q(t,e){t.traverseCallback(function(t){t.value.update(e.point.x)})}function Y(t){return JSON.parse(JSON.stringify(t))}t.Animation=y,t.CanvasRender=N,t.Geometry=R,t.convexIntersect=function(t,e,n){for(var i,r,o,s,h,a,u,l,c=[],f=new V(0,0),y=t.vertices.slice(0,-1),g=e.vertices.slice(0,-1),v=y.length,p=g.length,d=null,x=0,b=0,m=0,w=0;m<2*v&&w<2*p;){if(r=y[x],s=g[b],i=y[(x+v-1)%v],o=g[(b+p-1)%p],h=C(f,new V(r.x-i.x,r.y-i.y),new V(s.x-o.x,s.y-o.y)),a=C(o,s,r),u=C(i,r,s),null!==(l=new q(i,r).intersect(new q(o,s)))){if(0<c.length&&l.equal(c[0])){c.push(l);break}c.push(l),0<a?d="p":0<u&&(d="q")}if(0===h&&a<0&&u<0)return null;h===u===a===0?"p"===d?(b=(b+1)%p,w+=1):(x=(x+1)%v,m+=1):0<=h&&0<u||h<0&&a<=0?("p"===d&&c.push(r),x=(x+1)%v,m+=1):(0<=h&&u<=0||h<0&&0<a)&&("q"===d&&c.push(s),b=(b+1)%p,w+=1),Array.isArray(n)&&n.push({currentEdges:[new q(i,r),new q(o,s)],intersectPolygon:new z(c)})}return c.length<=2?null:new z(c)},t.grahamScanCH=function(t,e){var n,i=[],r=E(t);for(i.push(r.shift()),i.push(r.shift());0<r.length;)_(i[(n=i.length)-2],i[n-1],r[0])?i.push(r.shift()):i.pop(),e&&Array.isArray(e)&&e.push({vertice:r[0],chVertices:i.map(function(t){return new V(t.x,t.y)})});return i},t.incrementalCH=function(t,e){if(!(Array.isArray(t)&&e instanceof V))throw new TypeError("Paramters Type Error");if(t.length<2)t.push(e);else if(2===t.length)t.push(e),_.apply(M,l(t))||t.reverse();else{var n=[];t.unshift(t[t.length-1]),t.push(t[1]);for(var i=1;i<t.length-1;i++)_(t[i],t[i+1],e)?n.push(t[i]):_(t[i-1],t[i],e)&&(n.push(t[i]),n.push(e));t.splice.apply(t,[0,t.length].concat(n))}return t},t.segmentsIntersect=function(t,e){var n,i,r,o,s,h,a,u,l,c,f,y,g,v,p,d,x,b,m=(h=[],t.forEach(function(t){r=new G(t),s=t.begin.x<t.end.x||t.begin.x===t.end.x&&t.begin.y<t.end.y?(o=t.begin,t.end):(o=t.end,t.begin),h.push(new U(o,"leftEnd",[r])),h.push(new U(s,"rightEnd",[r]))}),new H(h,0,U.comparator)),w=new B(G.comparator);W.length=0;try{for(;0<m.length;){"leftEnd"===(y=m.pop()).type?(Q(w,y),a=k(y.segments,1)[0],w.insert(a),n=w.getLeft(a),i=w.getRight(a),n&&Z(m,a,n.value),i&&Z(m,a,i.value)):"rightEnd"===y.type?(Q(w,y),a=k(y.segments,1)[0],n=w.getLeft(a),i=w.getRight(a),n&&i&&Z(m,n.value,i.value),w.remove(a)):(c=l=void 0,G.comparator(y.segments[0],y.segments[1])<0?(l=(u=k(y.segments,2))[0],c=u[1]):(c=(f=k(y.segments,2))[0],l=f[1]),n=w.getLeft(l),(i=w.getRight(c))&&Z(m,l,i.value),n&&Z(m,c,n.value),v=l,p=c,x=d=void 0,d=(g=w).find(v),x=g.find(p),b=d.value,d.value=x.value,x.value=b,Q(w,y)),e&&Array.isArray(e)&&e.push({event:Y(y),statusTree:Y(w.traverse()),intersections:Y(W)})}}catch(t){console.log("Erroï¼š"),console.log(t)}return W},t.upperLowerCH=function(t){for(var e,n,i=[],r=[],o=t.slice().sort(function(t,e){return t.x-e.x||t.x===e.x&&t.y-e.y}),s=o.length-1;0<=s;)(e=i.length)<2||_(i[e-2],i[e-1],o[s])?(i.push(o[s]),--s):i.pop();for(s=0;s<o.length;)(n=r.length)<2||_(r[n-2],r[n-1],o[s])?(r.push(o[s]),s+=1):r.pop();return r.shift(),r.pop(),i.concat(r)},Object.defineProperty(t,"__esModule",{value:!0})});
